"use strict";$(function(){function e(){var e=$(this).attr("data-value"),a=y.length,o=0,n="/error";if(e)for(var s=0;s<a;s++){o=y[s].length;for(var i=0;i<o;i++)if(y[s][i].id===e){if(!y[s][i].isActive)break;n="/friend_player?id="+e}}window.location.href=n}function a(e){var a=y.length,o=0,n=null;if(e)for(var s=0;s<a;s++){o=y[s].length;for(var i=0;i<o;i++)if(y[s][i].id===e){n=y[s][i];break}}return n}function o(){T=A.CONFIRMATION_INACTIVE_REMOVE,C=String($(this).attr("data-value"));var e='<p class="tx_c">このプレイヤーをフレンド解除して</p><p class="tx_c">よろしいですか？</p><p class="tx_c">※再度フレンド申請を行うには、</p><p class="tx_c">このプレイヤーにプレイデータを</p><p class="tx_c">2.0EX3_05以上に更新してもらう必要があります。</p>';w.html("").html(e),v.resetDialogInfo(),$("#common_popup_accept").removeClass("display_none"),$("#common_popup_decline").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),x.removeClass("display_none").addClass("display_block")}function n(){var e=$(".bt_freind_approval"),a=$(".bt_freind_denial"),o=$("#page_nation li"),n=$("#comeback_gauge_bt"),i=$("#comeback_bt_receive");e.on("click",_),a.on("click",d),F.on("click",l),D.on("click",c),o.on("click",s),n.on("click",t),i.on("click",f),$(".friend_count_bonus").on("click",p),deviceInfo.isMobile&&(v.mobileBtnHover($(".bt_friend_gauge")),v.mobileBtnHover($("#friend_bt_receive")),v.mobileBtnHover($("#event_popup_close")),v.mobileBtnHover($("#sub_menu_search_player")))}function s(){var e=$(this);b=e.attr("data-value"),$("#page_nation li").removeClass("bt_current_navigation"),e.addClass("bt_current_navigation"),u(b)}function i(){if(T===A.CONSENT_CHECK_ALERT)w.html(""),deviceInfo.isMobile&&$("#friend_info_wrapper").removeClass("display_none").addClass("display_block"),x.removeClass("display_block").addClass("display_none");else{if(T===A.FRIEND_COUNT_BONUS)return void location.reload();T=A.CLOSE,deviceInfo.isMobile&&$("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")}}function l(){T===A.ACCEPTANCE_CONFIRMATION?r("ACCEPT",function(e,a){$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")}):T===A.DENIAL_CONFIRMATION?r("DENY",function(e,a){$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")}):T===A.CONFIRMATION_INACTIVE_REMOVE&&r("REMOVE",function(e,a){$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")})}function t(){deviceInfo.isMobile&&$("body").addClass("popup"),$("#comeback_popup_wrapper").removeClass("display_none").addClass("display_block")}function r(e,a){var o="",n={uk:uk,reqType:e,targetUserId:C};$.ajax({url:"/accept_friend",contentType:"application/json",dataType:"json",data:JSON.stringify(n),type:"POST",timeout:2e4,success:function(e,a,n){if(e.status===constant.responseStatus.SUCCESS)return void(T===A.CONFIRMATION_INACTIVE_REMOVE?location.reload():$("#friend_"+C).fadeOut(function(){location.reload()}));if(e.status===S.TARGET_GAME_LOGIN_ERROR)o='<p class="tx_c">対象のプレイヤーは現在ゲームにログイン中です。</p>';else if(e.status===S.MAX_FRIEND_ERROR)o='<p class="tx_c">フレンド人数が上限に達しています。</p>';else{if(e.status!==S.TARGET_MAX_FRIEND_ERROR)return void v.error(e.status);o='<p class="tx_c">対象のプレイヤーのフレンド人数が上限に達しています。</p>'}deviceInfo.isMobile&&$("body").addClass("popup"),v.resetDialogInfo(),$("#common_popup_close").removeClass("display_none"),$("#common_popup_wrapper").removeClass("display_none").addClass("display_block"),$("#popup_container").html("").html(o)},error:function(e,a,o){}})}function c(){T!==A.ACCEPTANCE_CONFIRMATION&&T!==A.DENIAL_CONFIRMATION&&T!==A.CONFIRMATION_INACTIVE_REMOVE||(T=A.CLOSE,deviceInfo.isMobile&&$("body").removeClass("popup"),x.removeClass("display_block").addClass("display_none"))}function _(){T=A.ACCEPTANCE_CONFIRMATION;var e='<p class="tx_c">以下のプレイヤーをフレンド承認しますか？</p>',a="";C=String($(this).attr("data-value"));for(var o=0;o<I.length;o++)if(C===I[o].id){a='<p class="tx_c">'+I[o].userName+"</p>";break}e+=a,w.html("").html(e),v.resetDialogInfo(),deviceInfo.isMobile&&$("body").addClass("popup"),$("#common_popup_accept").removeClass("display_none"),$("#common_popup_decline").removeClass("display_none"),x.removeClass("display_none").addClass("display_block")}function d(){T=A.DENIAL_CONFIRMATION;var e='<p class="tx_c">以下のプレイヤーをフレンド拒否しますか？</p>',a="";C=String($(this).attr("data-value"));for(var o=0;o<I.length;o++)if(C===I[o].id){a='<p class="tx_c">'+I[o].userName+"</p>";break}e+=a,w.html("").html(e),v.resetDialogInfo(),$("#common_popup_accept").removeClass("display_none"),$("#common_popup_decline").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),x.removeClass("display_none").addClass("display_block")}function p(){var e=$(this).attr("data-value"),a=N[e],o={uk:uk,cnt:a};$.ajax({url:"/get_friend_count_bonus",contentType:"application/json",dataType:"json",data:JSON.stringify(o),type:"POST",timeout:2e4,success:function(e,a,o){var n="";return e.status!==constant.responseStatus.SUCCESS?void v.error(e.status):(T=A.FRIEND_COUNT_BONUS,n='<p class="tx_c">特典プレゼントを入手しました。</p><p class="tx_c">次回サテライト筐体にログインした際、</p><p class="tx_c">アイテムが追加されます。</p>',deviceInfo.isMobile&&$("body").addClass("popup"),v.resetDialogInfo(),$("#common_popup_close").removeClass("display_none"),$("#common_popup_wrapper").removeClass("display_none").addClass("display_block"),$("#popup_container").html("").html(n),void 0)},error:function(e,a,o){v.error(constant.responseStatus.EXCEPTION_ERROR)}})}function u(e){for(var a="",o=0;o<y[e].length;o++){var n="",s=y[e][o].id,i=y[e][o].userName,l=y[e][o].isActive;n=""===i?"<li></li>":l?'<li class="active" data-value="'+s+'">'+i+"</li>":'<li class="inactive" data-value="'+s+'">'+i+"</li>",a+=n}$("#friend_list").html("").html(a)}function m(){for(var e="",a=0;a<k.length;a++){var o="";o="<dt>"+k[a].date+"</dt>",e+=o;for(var n=0;n<k[a].detail.length;n++){var s=k[a].detail[n],i='<dd><span class="time">'+s.time+'</span><span class="detail"><a href="/friend_player?id='+s.id+'">'+s.userName+"</a>さんが"+s.placeName+"で";s.logDetail&&s.logDetail.promotion_flag&&1===s.logDetail.promotion_flag&&(i+='<span class="font_g">[昇]</span>'),s.logDetail&&s.logDetail.reward_challenge_flag&&1===s.logDetail.reward_challenge_flag&&(i+='<span class="font_p">[チ]</span>'),i+=s.battleName+"をプレイ!</span></dd>",e+=i}}$("#log_time_list").html("").html(e)}function f(){}var v=new commonClass,C="",b=0,g=0,k=[],y=[],I=[],E=[],N=[],R={},h={},O=!1,T="",A={CLOSE:"CLOSE",FRIEND_COUNT_BONUS:"FRIEND_COUNT_BONUS",CONSENT_CHECK_ALERT:"CONSENT_CHECK_ALERT",ACCEPTANCE_CONFIRMATION:"ACCEPTANCE_CONFIRMATION",DENIAL_CONFIRMATION:"DENIAL_CONFIRMATION",CONFIRMATION_INACTIVE_REMOVE:"CONFIRMATION_INACTIVE_REMOVE"},S={TARGET_GAME_LOGIN_ERROR:"TARGET_GAME_LOGIN_ERROR",MAX_FRIEND_ERROR:"MAX_FRIEND_ERROR",TARGET_MAX_FRIEND_ERROR:"TARGET_MAX_FRIEND_ERROR"},M=$(".bt_arrow"),x=$("#common_popup_wrapper"),w=$("#popup_container"),F=$("#common_popup_accept"),D=$("#common_popup_decline"),P=$("#common_popup_close");$("#friend_list").on("click",".inactive",o),$("#friend_list").on("click",".active",e),null==document.getElementById("bt_comeback_code")||$("#bt_comeback_code").attr("class").match(/disable/)||$(".bt_comeback_code").on("click",function(){location.href="/comeback_code"}),$("#friend_info_navi .bt_next").on("click",function(e,a){var o=!1,n='<div class="tx_c">"上記の文章に同意する"にチェックが入っていません</div>';if(o=$("#consent_checkbox").prop("checked")){var s={uk:uk};$.ajax({url:"/accept_friend_agreement",contentType:"application/json",dataType:"json",data:JSON.stringify(s),type:"POST",timeout:2e4,success:function(e,a,o){return e.status===constant.responseStatus.SUCCESS?void $("#friend_info_wrapper").fadeOut("fast",function(){$("#friend_info_wrapper").removeClass("display_block").addClass("display_none"),location.reload()}):void v.error(e.status)},error:function(e,a,o){}})}else T=A.CONSENT_CHECK_ALERT,v.resetDialogInfo(),$("#common_popup_close").removeClass("display_none"),w.html("").html(n),deviceInfo.isMobile&&($("body").addClass("popup"),$("#friend_info_wrapper").removeClass("display_block").addClass("display_none")),x.removeClass("display_none").addClass("display_block")}),$("#friend_info_navi .bt_cancel").on("click",function(e,a){window.location.href="/information"}),P.on("click",i),$.ajax({url:"/get_friend_info",dataType:"json",success:function(e,a,o){if(e.isRegistered){var s="",i="";k=e.friendLogs,y=e.friendComps,I=e.friendReqs,E=e.friendPlayCountList,N=e.frinedCountBonus,R=e.frinedPointBonus,g=e.notificationCount,h=e.comebackCampaignInfo,E&&E.length>0&&(O=!0),$("#friend_point_bonus_term").html("").html(R.term),$("#user_fp").html("").html(R.fp.user),$("#friend_fp").html("").html(R.fp.friend),$("#total_fp").html("").html(R.fp.total);var l="",t="",r="";R.isReceivableReward?r="プレゼントを受け取れます！":R.isAllComp?(r="今週のプレゼントは全て受け取り済みです。",$("#friend_bt_receive").addClass("disable")):(r="あと"+R.fp.nextPresent+"FPで次のプレゼントを受け取れます。",$("#friend_bt_receive").addClass("disable")),$("#dialog_next_fp").html("").html(r);for(var c in R.reward){var _=R.reward[c],d="",p="",f="display_none";_.isComp&&(f="display_block"),d='<li id="friend_gauge_reward'+_.type+'">'+_.text+"</li>",p='<div id="gauge_line'+_.type+'" style="left: '+_.ratio+'%;"></div><div id="gauge_mark'+_.type+'" style="left: '+_.ratio+'%;"><span id="reward_fp_'+_.type+'">'+_.fp+'</span>FP<span class="gauge_comp '+f+'"></span></div>',l=d+l,t=p+t}if($("#friend_gauge_period").html("").html(R.term),$("#dialog_total_fp").html("").html(R.fp.total),$("#friend_gauge_bar").css("width",R.fp.gaugeRatio+"%"),$("#friend_gauge_reward_list").html("").html(l),$("#friend_gauge_line").html("").html(t),N.length>0)for(var v=0;v<N.length;v++){var C="";g++,C='<li class="friend_count_bonus" data-value="'+v+'"><a herf="#">フレンド登録'+N[v]+"人目達成！特典プレゼントを受け取れます。</a></li>",i+=C}m();for(var v=0;v<y.length;v++)s+=0===v?'<li id="page_bt'+v+'" class="bt_current_navigation" data-value="'+v+'"></li>':'<li id="page_bt'+v+'" class="" data-value="'+v+'"></li>';for(var v=0;v<I.length;v++){var b=I[v].id,T=I[v].userName,A='<li id="friend_'+b+'"><a href="/friend_player?id='+b+'">'+T+'</a>さんからフレンド申請が来ています<div class="select_buttons"><div class="bt_freind_approval" data-value="'+b+'"></div><div class="bt_freind_denial" data-value="'+b+'"></div></div></li>';i+=A}u(0),$("#notice_sum_value").html("").html(g),$("#page_nation").html("").html(s),$("#friend_message_list").html("").html(i),g>0&&$("#friend_request").removeClass("close").addClass("open"),h.ratio>100&&(h.ratio=100),$("#comeback_gauge_bar").css("width",h.ratio+"%"),$("#dialog_comeback_point").text(h.count+"人"),h.nextCount&&$("#dialog_next_comeback_point").text("あと"+h.nextCount+"人で次のプレゼントが受け取れます。"),h.isBonusRecivable||$("#comeback_bt_receive").addClass("disable"),n()}},error:function(e,a,o){v.error(constant.responseStatus.EXCEPTION_ERROR)}}),$("#friend_gauge_bt").on("click",function(){deviceInfo.isMobile&&$("body").addClass("popup"),$("#event_popup_wrapper").removeClass("display_none").addClass("display_block")}),$(".bt_close").on("click",function(){deviceInfo.isMobile&&$("body").removeClass("popup"),$("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),$("#comeback_popup_wrapper").removeClass("display_block").addClass("display_none")}),$("#friend_bt_receive").on("click",function(){if(R.isReceivableReward){var e={uk:uk,userFp:R.fp.user,friendFp:R.fp.friend};$.ajax({url:"/get_friend_point_bonus",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,a,o){var n="",s="";if(e.status===constant.responseStatus.SUCCESS){n+="FPボーナスとして";for(var i=0;i<e.receivableTypeIds.length;i++)if(e.receivableTypeIds[i]in R.reward){var l=R.reward[e.receivableTypeIds[i]];$("#gauge_mark"+l.type+" .gauge_comp").removeClass("display_none").addClass("display_block"),n+="<br>「"+l.text+"」を受け取りました。"}return s=0===R.fp.nextPresent?"今週のプレゼントは全て受け取り済みです。":"あと"+R.fp.nextPresent+"FPで次のプレゼントを受け取れます。",$("#dialog_next_fp").html("").html(s),$("#gauge_receive_info").html("").html(n),R.isReceivableReward=!1,$("#friend_bt_receive").addClass("disable"),void $("#gauge_receive_info").removeClass("display_none").addClass("display_block")}return $("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),void v.error(e.status)},error:function(e,a,o){$("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),v.error(constant.responseStatus.EXCEPTION_ERROR)}})}}),M.on("click",function(){var e=$(this),o=e.attr("data-box"),n=$("#friend_"+o);"comeback"===o&&(n=$("#comeback_campaign"));var s=n.hasClass("open");if(!s&&O&&"ranking"===o){O=!0,$("#friend_ranking_content").html(""),$("#friend_ranking_text").removeClass("display_block").addClass("display_none"),$("#play_count_rank").removeClass("display_block").addClass("display_none");var i="",l=E.length;if(l>0){i='<div id="friend_ranking_title"></div>';for(var t=0;t<l&&!(t>2);t++){var r=a(E[t].id),c="",_="",d="";""!==r.codeNameInfo.textImg&&(_='<img src="'+r.codeNameInfo.textImg+'" />'),""!==r.codeNameInfo.plateImg&&(d='<img src="'+r.codeNameInfo.plateImg+'" />'),c='<div id="rank_'+(t+1)+'" class="ranking_primary"><ul><li class="ranking_player-name"><a href="/friend_player?id='+r.id+'">'+r.userName+'</a></li><li class="ranking_code-name">                  '+d+_+'</li><li class="ranking_score">'+E[t].count+'</li><li class="ranking_region">'+r.regionName+'</li><li class="ranking_place"><span>'+r.placeName+'</span></li><li class="ranking_joker1 '+r.characterInfo[0].tag+'"></li><li class="ranking_joker2 '+r.characterInfo[1].tag+'"></li><li class="ranking_agent-rank" style="background:url(img/agent_rank/agent_rank_l_'+("00"+r.agentRankId).slice(-2)+'.png) no-repeat; background-size: 100%;">',r.agentRankId>60&&r.level&&r.level>0&&(c+='<span id=rank_card_level" class="rank_card_level">'+r.level+"</span>"),c+="</li></ul></div>",i+=c}$("#friend_ranking_content").html("").html(i),$("#friend_ranking_text").removeClass().addClass("display_none"),$("#play_count_rank").removeClass().addClass("display_block")}else $("#friend_ranking_content").html(""),$("#friend_ranking_text").removeClass("display_none").addClass("display_block"),$("#play_count_rank").removeClass("display_block").addClass("display_none")}s?n.removeClass("open").addClass("close"):n.removeClass("close").addClass("open")}),$("#comeback_bt_receive").on("click",function(){if(h.isBonusRecivable){var e={uk:uk,comebackCount:h.count,isBonusRecivable:h.isBonusRecivable,recivedBonusCount:h.recivedBonusCount};$.ajax({url:"/get_comeback_code_bonus",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(a,o,n){var s="",i="",l="<br>「見習い魔導士リーナ（水着）フォイル × 3」",t="<br>「ACブーストEX × 3、カードブーストEXチケット × 3」",r="<br>「リナのシャープリィチケット × 3」";return a.status===constant.responseStatus.SUCCESS?(s+="カムバックキャンペーンボーナスとして",0==e.recivedBonusCount?(e.comebackCount>=1&&(s+=l),e.comebackCount>=3&&(s+=t),e.comebackCount>=5&&(s+=r)):1==e.recivedBonusCount?(e.comebackCount>=3&&(s+=t),e.comebackCount>=5&&(s+=r)):2==e.recivedBonusCount&&e.comebackCount>=5&&(s+=r),s+="を受け取りました。",e.recivedBonusCount>=3&&(i="カムバックキャンペーンボーナスは全て受け取り済みです。"),$("#dialog_next_comeback_point").html("").html(i),$("#comeback_gauge_receive_info").html("").html(s),h.isBonusRecivable=!1,$("#comeback_bt_receive").addClass("disable"),void $("#comeback_gauge_receive_info").removeClass("display_none").addClass("display_block")):($("#comeback_popup_wrapper").removeClass("display_block").addClass("display_none"),void v.error(a.status))},error:function(e,a,o){$("#comeback_popup_wrapper").removeClass("display_block").addClass("display_none"),v.error(constant.responseStatus.EXCEPTION_ERROR)}})}})});