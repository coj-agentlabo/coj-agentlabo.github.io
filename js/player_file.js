"use strict";$(function(){function e(){$("#joker_img_box").offset().left==ne&&($("#char_ic_arrow").remove(),$("#profile_area").off("scroll","**"))}function a(){ne=$(document).outerWidth()-$("#joker_img_box").outerWidth()}function n(){if(ee){var e=parseInt($("#detail_virus_bt").attr("data-value"),10);H.expandCardImg(e,ee,ae)}else H.expandCardImg(se,!1,!1)}function o(){var e=parseInt($(this).attr("data-value"),10);ae=$("#card_detail_foil").hasClass("display_block"),null!=e&&0!==e&&($(this).hasClass("bt_virus")?(ee=!0,H.cardDetailDialog(e,!1,!1,ae,ee)):(ee=!1,H.cardDetailDialog(se,!1,!1,ae,ee)))}function t(){ee=!1,ae=!1,$("#card_detail_wrapper").removeClass("display_block").addClass("display_none")}function i(){var e=$(this);if(!e.hasClass("disable")){var a=e.attr("id");e.addClass("active"),$("#char_"+te[ie]).removeClass("active"),te[ie]=a.split("_")[1],s(e),l()}}function s(e){var a=12,n=4;deviceInfo.isMobile&&(a=5,n=7);var o=e.position().top-a,t=e.position().left-n;$("#char_move_frame").css({top:o,left:t}),$("#char_move_frame").removeClass("display_none")}function l(){var e=oe[te[ie]],a="";$("#joker_img").removeClass().addClass(e.tag),$("#joker_agent").html("").html(e.agentName),$("#joker_name").html("").html(e.jokerName);for(var n=0;n<e.abilities.length;n++){var o="",t=e.abilities[n],i="";i=t.lv<10?"Lv "+t.lv:"Lv MAX",o='<div class="joker_item_box"><ul class="joker_item_data"><li id="joker_item_name_1">'+t.abilityName+'</li><li id="joker_item_cost_1">CP '+t.cp+'</li><li id="joker_item_level_1">'+i+'</li><li id="joker_item_exp_1"><span id="exp_bar_1" style="width: '+t.expRatio+'%"></span></li><li id="joker_item_speed_1">ゲージ消費量 '+t.gaugeSpeed+'</li><li id="joker_item_op_1">オリジナルP '+t.op+'P</li><li id="joker_item_text_1">'+t.ability+'</li></ul><div class="joker_item_card '+t.agentTag+'"><div class="joker_no'+t.no+'"></div></div></div>',a+=o}$("#joker_item_container").removeClass("display_none").html("").html(a)}function _(){Q=new BulletinBoardClass(se),Q.DisplayDialog()}function r(){Q.ClickWantCardNormalButton()}function c(){Q.ClickWantCardFoilButton()}function d(){Q.ClickReleaseCardNormalButton()}function p(){Q.ClickReleaseCardFoilButton()}function m(){Q.clickDialogAcceptBtn()}function u(){Q.clickDialogDeclineBtn()}function v(){deviceInfo.isMobile?($("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")):E()}function h(){$("#main_wrapper").removeClass().addClass("player_file"),$("#sub_menu_page_top").css("display","block")}function f(){$("#main_wrapper").removeClass().addClass("joker_file"),$("#sub_menu_page_top").css("display","none"),$("#char_frame_1p").hasClass("char_display_block")&&$("#char_jin").hasClass("active")&&s($("#char_frame_1p div:first-child"))}function C(){$("#main_wrapper").removeClass().addClass("event_file"),$("#sub_menu_page_top").css("display","none")}function b(){Z||g(),$("#main_wrapper").removeClass().addClass("mission_file"),$("#sub_menu_page_top").css("display","none")}function y(){var e=parseInt($(this).attr("data-id"),10),a=!1;se=e,H.cardDetailDialog(e,a)}function g(){Z=!0,$.ajax({url:"/get_mission_info",type:"GET",timeout:2e4,success:function(e,a,n){if(e.status===$e.SUCCESS){ce=e.mission_category,de=e.mission_info;var o=[],t=0;"BEGINNER"in ce?t=ce.BEGINNER.id:"INFINITY"in ce&&(t=ce.INFINITY.id),$("#ticket_boost_ex").html("").html(e.ticket_card_boost_ex),$("#ticket_star_boost").html("").html(e.ticket_star_boost),$("#ticket_money_ac").html("").html(e.ticket_coin_boost),$("#mission_mp").html("").html(String(e.mp).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));for(var i in ce)o.push(ce[i]);o.sort(function(e,a){return e.sort_num-a.sort_num});for(var s="",l=0;l<o.length;l++){var _=o[l].text,r="";o[l].id==t&&(r=" selected"),s+='<option value="'+o[l].id+'"'+r+">"+_+"</option>"}R(t),$("#mission_select_box").html("").html(s),$("#mission_select_box").change(k)}else e.status===$e.PLAY_VERSION_ERROR?(pe=!0,$("#action_wrapper").removeClass("display_none"),deviceInfo.isSmartPhone&&$("body").addClass("action_popup"),$("#dialog_main_text").html("").html(me.VERSION_ERROR),$("#action_close").removeClass("display_none")):($("#action_wrapper").removeClass(""),deviceInfo.isSmartPhone&&$("body").addClass("action_popup"),$("#dialog_main_text").html("").html(me.NETWORK_ERROR),$("#action_close").removeClass("display_none"))},error:function(e,a,n){$("#action_wrapper").removeClass("display_none"),deviceInfo.isSmartPhone&&$("body").addClass("action_popup"),$("#dialog_main_text").html("").html(me.NETWORK_ERROR),$("#action_close").removeClass("display_none")}})}function k(){var e=Number($("#mission_select_box").val());R(e)}function R(e){if(e in de){$("#mission_list_container").removeClass("display_none"),$("#actis_info").addClass("display_none");var a=de[e],n=String(a.term_text),o="";$("#mission_count_period").html("").html(n);for(var t=0;t<a.mission_detail.length;t++){var i=a.mission_detail[t],s=t+1,l="";1==i.finish_flag&&(l="clear");var _='<div class="mission_plate '+l+'"><div class="mission_number"><img src="img/pc/mission/mission_number'+s+'.png"></div><div class="mission_text"><span>'+i.mission_text+'</span></div><div class="mission_gauge"><span class="gauge_bar" style="width: '+i.achievement_rate+'%;"></span></div><div class="mission_rate">'+i.achievement_rate_text+'</div><div class="mission_reward">'+i.reward_text+"</div></div>";o+=_}var r=a.total_mission_detail,c="";1==r.finish_flag&&(c="clear");var d='<div class="mission_plate bonus '+c+'"><div class="mission_text"><span>'+r.mission_text+'</span></div><div class="mission_gauge"><span class="gauge_bar" style="width: '+r.achievement_rate+'%;"></span></div><div class="mission_rate">'+r.achievement_rate_text+'</div><div class="mission_reward">'+r.reward_text+"</div></div>";o+=d,$("#mission_list_container").html("").html(o)}else $("#mission_list_container").addClass("display_none"),$("#actis_info").removeClass("display_none"),$("#mission_count_period").html("").html("--")}function w(){var e=0,a=0;$("#bt_joker_left").hasClass("display_none")?($("#bt_joker_left").removeClass("display_none"),$("#bt_joker_right").addClass("display_none"),$("#char_frame_1p").removeClass("char_display_block").addClass("char_display_none"),$("#char_frame_2p").removeClass("char_display_none").addClass("char_display_block"),a=2):$("#bt_joker_right").hasClass("display_none")&&($("#bt_joker_right").removeClass("display_none"),$("#bt_joker_left").addClass("display_none"),$("#char_frame_2p").removeClass("char_display_block").addClass("char_display_none"),$("#char_frame_1p").removeClass("char_display_none").addClass("char_display_block"),a=1),$("#char_move_frame").addClass("display_none"),$("#joker_item_container").addClass("display_none"),ie=a,e=$("#char_frame_"+a+"p div").length;for(var n=0;n<e;n++){var o=$("#char_frame_"+a+"p div").eq(n);if(o.hasClass("active")){te[ie]=o.attr("id").split("_")[1],s(o),l();break}}}function I(){var e=$(this),a=!1,n=parseInt(e.attr("data-id"),10);H.cardDetailDialog(n,a),se=n}function O(){var e=$(this),a=parseInt(e.attr("data-year"),10),n=parseInt(e.attr("data-month"),10),o=e.attr("data-log"),t=$("#log_section_"+o),i={uk:uk,year:a,month:n,logIndex:o};t.html().indexOf("log_box")<=0&&($.ajax({url:"/get_tournament_result",contentType:"application/json",dataType:"json",data:JSON.stringify(i),type:"POST",timeout:2e4,success:function(e){var a=t.html();a+=e.html,t.html(a)},error:function(){H.error(constant.responseStatus.EXCEPTION_ERROR)}}),e.removeClass("tournament"))}function E(){$("#common_popup_wrapper").removeClass("display_block").addClass("display_none"),$("#common_popup_close").removeClass("display_none"),$("#common_popup_accept").removeClass("display_block").addClass("display_none"),$("#common_popup_accept").attr("data-value",""),$("#common_popup_decline").removeClass("display_block").addClass("display_none"),$("#popup_container").html("").html("")}function x(){var e=$("#codename_now").attr("src"),a=$("#name_plate_now").attr("src"),n="";n=a.indexOf("codename_plate_none")>=0?'<img src="'+e+'">':'<img src="'+a+'"><img src="'+e+'">',$("#profile_code_name").html("").html(n),$("#codename_popup_wrapper").removeClass("display_block").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup")}function j(e){var a="";return a=e>0?"img/code_name/name/codename_"+("000"+e).slice(-4)+".png":"img/code_name/plate/codename_plate_question.png"}function S(e){var a="";return a=0==e?"img/code_name/plate/codename_plate_none.png":e>0?"img/code_name/plate/codename_plate_"+("000"+e).slice(-4)+".png":"img/code_name/plate/codename_plate_question.png"}function N(){return $("#codename_now").attr("data-id")}function T(){return $("#name_plate_now").attr("data-id")}function P(){$("#codename_popup_wrapper").removeClass("display_none").addClass("display_block"),0==$("#name_plate_now").attr("data-id")&&$("#bt_remove").addClass("disable"),deviceInfo.isMobile?($("body").addClass("popup"),$("body").scrollTop(0)):$("#codename_popup_wrapper").scrollTop(0)}function A(){for(var e="",a=1;a<7;a++)e=$("#codename_rarity"+a).html(),e=e.replace(/\s+/g,""),0==e.length&&$("#codename_rarity"+a).html("所持していません");if(B("codename"),navigator.userAgent.indexOf("iPhone")!=-1){var n=parseInt(navigator.userAgent.toLowerCase().match(/os (\d+)_?/)[1],10);n<=8&&($("#codename_type").prop("disabled",!0),$("#codename_type").css({color:"#777"}))}}function D(){for(var e="",a=1;a<5;a++)e=$("#name_plate_rarity"+a).html(),e=e.replace(/\s+/g,""),0==e.length&&$("#name_plate_rarity"+a).html("所持していません");if(B("name_plate"),navigator.userAgent.indexOf("iPhone")!=-1){var n=parseInt(navigator.userAgent.toLowerCase().match(/os (\d+)_?/)[1],10);n<=8&&($("#name_plate_type").prop("disabled",!0),$("#name_plate_type").css({color:"#777"}))}}function B(e){$("#bt_decide_"+e).addClass("disable"),$("#change_codenameplate_container").removeClass("display_block").addClass("display_none"),$("#change_"+e+"_container").removeClass("display_none").addClass("display_block")}function L(){$(this).hasClass("disable")||($("input[name=codename]:checked").val()?X():G())}function M(){$(this).hasClass("disable")||($("input[name=name_plate]:checked").val()?J($("input[name=name_plate]:checked").val()):W())}function G(){var e="",a=N();e=j(a),V("codename",e,4)}function W(){var e="",a=T();e=S(a),V("name_plate",e,1)}function V(e,a,n){$("#change_codenameplate_container").removeClass("display_none").addClass("display_block"),$("#change_"+e+"_container").removeClass("display_block").addClass("display_none"),$("input[name="+e+"]:checked").prop("checked",!1),$("#"+e+"_type").val(n),$("#"+e+"_sample").attr("src",a),$("#bt_decide_"+e).removeClass("disable"),U(e,n)}function q(){var e=$(this),a=e.attr("value"),n=e.attr("name"),o="",t=0;if("codename"===n?(o=j(a),t=N()):"name_plate"===n&&(o=S(a),t=T()),a==t?$("#bt_decide_"+n).addClass("disable"):$("#bt_decide_"+n).removeClass("disable"),$("#"+n+"_sample").attr("src",o),navigator.userAgent.indexOf("iPhone")!=-1){var i=parseInt(navigator.userAgent.toLowerCase().match(/os (\d+)_?/)[1],10);i<=8&&($("#"+n+"_type").prop("disabled",!1),$("#"+n+"_type").css({color:""}))}}function U(e,a){for(var n=0,o=1;o<=$("#"+e+"_radio ul").length;o++)n=$("#"+e+"_radio ul:nth-child("+o+")").attr("data-rarity"),a==n?$("#"+e+"_radio ul:nth-child("+o+")").removeClass("display_none").addClass("display_block"):$("#"+e+"_radio ul:nth-child("+o+")").removeClass("display_block").addClass("display_none")}function Y(){var e=$("#codename_type").prop("selectedIndex"),a=$("#codename_type option:eq("+e+")").val();U("codename",a)}function F(){var e=$("#name_plate_type").prop("selectedIndex"),a=$("#name_plate_type option:eq("+e+")").val();U("name_plate",a)}function X(){var e="",a="",n=$("#codename_now").attr("data-id"),o=$("input[name=codename]:checked").val(),t={uk:uk,codenameId:o};o!=n&&(a=$("#codename_sample").attr("src"),$.ajax({url:"/save_codename",contentType:"application/json",dataType:"json",data:JSON.stringify(t),type:"POST",timeout:2e4,success:function(e){e.status===$e.SUCCESS?($("#codename_now").attr("src",a),$("#codename_now").attr("data-id",o),$("#codename_new_1").attr("src",a),K("codename")):z(e.text)},error:function(){e="コードネームの変更に失敗しました。",z(e)}}))}function J(e){var a="",n="",o=$("#name_plate_now").attr("data-id"),t={uk:uk,namePlateId:e};e!=o&&(n=$("#name_plate_sample").attr("src"),$.ajax({url:"/save_name_plate",contentType:"application/json",dataType:"json",data:JSON.stringify(t),type:"POST",timeout:2e4,success:function(a){$("#loading_wrapper").removeClass("display_block").addClass("display_none"),a.status===$e.SUCCESS?($("#name_plate_now").attr("src",n),$("#name_plate_now").attr("data-id",e),$("#name_plate_new_1").attr("src",n),e>0&&$("#bt_remove").removeClass("disable"),K("name_plate")):z(a.text)},error:function(){a="ネームプレートの変更に失敗しました。",z(a)}}))}function K(e){$("#change_codenameplate_container").removeClass("display_none").addClass("display_block"),$("#change_"+e+"_container").removeClass("display_block").addClass("display_none"),$("input[name="+e+"]:checked").prop("checked",!1),$("#bt_decide_"+e).removeClass("disable")}function z(e){$("#codename_popup_wrapper").removeClass("display_block").addClass("display_none"),$("#common_popup_wrapper").removeClass("display_none").addClass("display_block"),$("#popup_container").html("").html(e)}var H=new commonClass,Q=(new CommonDialogClass,new BulletinBoardClass),Z=!1,ee=!1,ae=!1;if(Q.getOrderBoardInfo(),$("#tab_menu_player").on("click",h),$("#tab_menu_joker").on("click",f),$("#tab_menu_event").on("click",C),$("#tab_menu_mission").on("click",b),$(".event_reward").on("click",y),$(".char_plate").on("click",i),$("#card_detail_image_container").on("click",n),$("#enlarge_close_bt").on("click",H.expandCardImgClose),$("#detail_order_board_bt").on("click",_),$("#order_board_popup_cancel").on("click",Q.CloseDialog),$("#bt_order_board_popup_want_normal").on("click",r),$("#bt_order_board_popup_want_foil").on("click",c),$("#bt_order_board_popup_release_normal").on("click",d),$("#bt_order_board_popup_release_foil").on("click",p),$("#common_popup_accept").on("click",m),$("#common_popup_decline").on("click",u),$("#common_popup_close").on("click",v),$("#detail_virus_bt").on("click",o),$("#card_detail_close_bt").on("click",t),$("#bt_joker_right").on("click",w),$("#bt_joker_left").on("click",w),deviceInfo.isMobile){var ne=$(document).outerWidth()-$("#joker_img_box").outerWidth();$("#profile_area").scroll(e),deviceInfo.isAndroid?$(window).on("resize",a):$(window).on("orientationchange",a)}$(document).on("click",".tournament_card_thum",I),$(".tournament").on("click",O),$("#bt_codename_plate_change").on("click",P),$("#bt_codename_plate_cancel").on("click",x),$("#bt_set_codename").on("click",A),$("#bt_decide_codename").on("click",L),$("#bt_cancel_codename").on("click",G),$("#bt_set_name_plate").on("click",D),$("#bt_decide_name_plate").on("click",M),$("#bt_cancel_name_plate").on("click",W),$(":radio").on("change",q),navigator.userAgent.indexOf("iPhone")!=-1?($("#codename_type").focusout(Y),$("#name_plate_type").focusout(F)):($("#codename_type").change(Y),$("#name_plate_type").change(F));var oe={},te={},ie=0,se=0,le={},_e=[],re="",ce={},de={},pe=!1,me={NETWORK_ERROR:"ネットワーク環境のいい所で<br>もう一度お試しください。",VERSION_ERROR:"Ver.1.4以降のサテライト筐体にログインし、プレイデータを更新してください。<br>※「ミッション」ページのご利用は、プレイデータがVer.1.4以降の方が対象です。",SESSION_ERROR:"サーバーとの接続が切れました。<br>ログインページに戻って再度ログインし直してください。",GAME_LOGIN_ERROR:"現在ゲームにログイン中です。<br>ゲームからログアウトし、ページを再読み込みした後もう一度お試しください。",VALIDATION_ERROR:"情報が古くなっている為、ページを再読み込みします。",MP_SHORTAGE:"MPが不足しています。"},$e={SUCCESS:"SUCCESS",SESSION_ERROR:"SESSION_ERROR",PLAY_VERSION_ERROR:"PLAY_VERSION_ERROR",GAME_LOGIN_ERROR:"GAME_LOGIN_ERROR",EXCEPTION_ERROR:"EXCEPTION_ERROR"};_e=location.search.substring(1).split("&");for(var ue=0;_e[ue];ue++){var ve=_e[ue].split("=");le[ve[0]]=ve[1]}"page"in le&&(re=le.page),"event"===re&&C(),$.ajax({url:"/get_player_file_info",dataType:"json",success:function(e,a,n){var o=$("#char_frame_1p div:first-child"),t=o.attr("id");oe=e.jokerInfo,o.addClass("active"),ie=1,te[ie]=t.split("_")[1];for(var i in oe){var s=$("#char_"+oe[i].tag);1===oe[i].isOwner&&s.removeClass("disable"),1===oe[i].isNew&&(s.append('<span id="char_new_ic" class="ic_new"></span>'),$("#bt_joker_right").append('<span id="char_new_ic" class="ic_new"></span>'))}l()},error:function(e,a,n){}}),$("#action_close").on("click",function(){pe?window.location.href="/information":location.reload()})});