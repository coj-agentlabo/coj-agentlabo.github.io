"use strict";$(function(){function a(){setTimeout(I,0),sortType=constant.sort.num.id,localStorage.cardBoxDispNational?1==localStorage.cardBoxDispNational&&$("#filter_classic input:checkbox").prop("checked",!0):localStorage.cardBoxDispNational=0,e(),T.applyCardBoxFilter()}function e(){var a="",e=[];for(var l in constant.sort)e.push(constant.sort[l]);e.sort(function(a,e){return a.id<e.id?-1:a.id>e.id?1:0});for(var s=0;s<e.length;s++){var r=e[s].id,i=e[s].text;a+='<option value="'+r+'">'+i+"</option>"}$("#m_card_sort_type").html("").html(a),$("#p_card_sort_type").html("").html(a)}function l(){$("#cardbox_card").on("click","li",B),$("#left_s_bt").on("click",x),$("#right_s_bt").on("click",w),$("#list_card_img").on("click",y),$("#card_detail_image_container").on("click",y),$("#enlarge_close_bt").on("click",k),$("#close_filter_bt").on("click",f),$("#p_card_sort_type").change(S),$('#filter_list input[type="checkbox"]').on("change",u),$("#common_popup_close").on("click",m),$("#common_popup_accept").on("click",n),$("#common_popup_decline").on("click",c),$("#detail_virus_bt").on("click",p),$("#list_virus_bt").on("click",p),$("#detail_favo_bt").on("click",g),$("#detail_order_board_bt").on("click",r),$("#list_order_board_bt").on("click",r),$("#order_board_popup_cancel").on("click",z.CloseDialog),$("#bt_order_board_popup_want_normal").on("click",i),$("#bt_order_board_popup_want_foil").on("click",o),$("#bt_order_board_popup_release_normal").on("click",d),$("#bt_order_board_popup_release_foil").on("click",t),deviceInfo.isMobile?($("#sub_menu_search_filter").on("click",C),$("#m_card_search_text").focus(T.focusSearchBox),$("#m_card_search_text").blur(T.blurSearchBox),$("#sub_menu_page_left").on("click",x),$("#sub_menu_page_right").on("click",w),$("#submit_bt").on("click",_),$(".bt_arrow").on("click",s)):($("#filter_wrapper").on("click",f),$("#list_favo_bt").on("click",g),$("#select_filter_bt").on("click",v),$("#p_card_sort_type").change(S),$("#p_card_search").focus(T.focusSearchBox),$("#p_card_search").blur(T.blurSearchBox),$("#p_card_search").keyup(M))}function s(){var a=$(this),e=a.attr("data-val"),l=$("#filter_"+e);if(l.hasClass("open"))l.removeClass("open").addClass("close");else if(l.removeClass("close").addClass("open"),"foil"===e){var s=$("#filter_list").get(0).scrollHeight,r=$("#filter_list").height(),i=s-r;$("#filter_list").animate({scrollTop:i})}}function r(){z=new BulletinBoardClass(O),z.DisplayDialog()}function i(){z.ClickWantCardNormalButton()}function o(){z.ClickWantCardFoilButton()}function d(){z.ClickReleaseCardNormalButton()}function t(){z.ClickReleaseCardFoilButton()}function n(){z.clickDialogAcceptBtn()}function c(){z.clickDialogDeclineBtn()}function r(){z=new BulletinBoardClass(O),z.DisplayDialog()}function _(){var a=$("#m_card_search_text").val();a===constant.defaultSearchWord?searchWord="":searchWord=a,T.applyCardBoxFilter(),S(),X.removeClass("popup"),$("#filter_wrapper").removeClass("display_block").addClass("display_none")}function p(){for(var a=!1,e=parseInt($(this).attr("data-value"),10),l=!1,s=!1,r=0;r<j.length;r++)if(j[r].id===O){a=!0;break}null!=e&&0!==e&&(deviceInfo.isMobile||P||(l=!0),deviceInfo.isMobile||P?$("#card_detail_foil").hasClass("display_block")&&(s=!0):$("#list_foil").hasClass("display_block")&&(s=!0),$(this).hasClass("bt_virus")?(W=!0,N.cardDetailDialog(e,!1,l,s,W)):(W=!1,N.cardDetailDialog(O,a,l,s,W)))}function C(){X.removeClass().addClass("popup"),$("#filter_wrapper").removeClass("display_none").addClass("display_block")}function m(){deviceInfo.isMobile&&X.removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")}function g(){N.changeFavorite(O)}function u(){var a=$(this);T.changeFilterCheckBox(a),S()}function f(a){deviceInfo.isMobile?(T.mobileFilterCancel(),$("body").removeClass(),$("#filter_wrapper").removeClass("display_block").addClass("display_none")):$(a.target).closest("#filter_palette").length&&!$(a.target).closest("#close_filter_bt").length||$("#filter_wrapper").removeClass("display_block").addClass("display_none")}function v(){T.displayPcFilter()}function b(){if(!U){U=!0,W=!1;var a=0,e=0,l=0,s=O,r={},i={},o={},d=L-1,t=A[d],n=0,c=$(".leftCard").attr("id"),_=$(".centerCard").attr("id"),p=$(".rightCard").attr("id"),C=!1;if(deviceInfo.isMobile){var m=q.width();a=m<400?m:400}else a=$("#card_enlarge_container").width();for(var g=0;g<t.length;g++)if(s===t[g].id){n=g;break}if(i=masterCard[s%1e4],$("#enlarge_next_bt").removeClass("display_none").addClass("display_block"),n-1<=0){if(!t[n-1])return void(U=!1);C=!0,$("#enlarge_prev_bt").removeClass("display_block").addClass("display_none"),l=t[n-1].id,o=masterCard[l%1e4]}else l=t[n-1].id,o=masterCard[l%1e4],e=t[n-2].id,r=masterCard[e%1e4];O=l,D(O),$(".leftCard").animate({right:"0px"},"400","swing",function(){e>=1e4?$("#"+p+" .foil_large").removeClass("display_none").addClass("display_block"):$("#"+p+" .foil_large").removeClass("display_block").addClass("display_none"),$("#"+_).removeClass("centerCard").addClass("rightCard").css("z-index",Q),$("#"+_+" .card_enlarge_image").css("background-image","url("+i.l_img+")"),s>=1e4?$("#"+_+" .foil_large").removeClass("display_none").addClass("display_block"):$("#"+_+" .foil_large").removeClass("display_block").addClass("display_none"),$("#"+c).removeClass("leftCard").addClass("centerCard").css("z-index",K),$("#"+p).removeClass("rightCard").addClass("leftCard").css("z-index",J).css("right",a+"px"),C||(""!==r.ill?$("#"+p+" .card_illustrator_name").removeClass("display_none").addClass("display_block").html("").html(constant.illustratedBy+r.ill):$("#"+p+" .card_illustrator_name").removeClass("display_block").addClass("display_none").html(""),$("#"+p+" .card_enlarge_image").css("background-image","url("+r.l_img+")")),U=!1})}}function h(){if(!U){U=!0,W=!1;var a=0,e=O,l=0,s=0,r={},i={},o={},d=L-1,t=A[d],n=0,c=$(".leftCard").attr("id"),_=$(".centerCard").attr("id"),p=$(".rightCard").attr("id"),C=!1;if(deviceInfo.isMobile){var m=q.width();a=m<400?m:400}else a=$("#card_enlarge_container").width();for(var g=0;g<t.length;g++)if(e===t[g].id){n=g;break}if(r=masterCard[e%1e4],$("#enlarge_prev_bt").removeClass("display_none").addClass("display_block"),n+2>=t.length){if(!t[n+1])return void(U=!1);C=!0,$("#enlarge_next_bt").removeClass("display_block").addClass("display_none"),l=t[n+1].id,o=masterCard[l%1e4]}else l=t[n+1].id,o=masterCard[l%1e4],s=t[n+2].id,i=masterCard[s%1e4];O=l,D(O),$("#"+_).animate({right:a+"px"},"400","swing",function(){s>=1e4?$("#"+c+" .foil_large").removeClass("display_none").addClass("display_block"):$("#"+c+" .foil_large").removeClass("display_block").addClass("display_none"),$("#"+_).removeClass("centerCard").addClass("leftCard").css("z-index",J),$("#"+_+" .card_enlarge_image").css("background-image","url("+r.l_img+")"),e>=1e4?$("#"+_+" .foil_large").removeClass("display_none").addClass("display_block"):$("#"+_+" .foil_large").removeClass("display_block").addClass("display_none"),$("#"+p).removeClass("rightCard").addClass("centerCard").css("z-index",K),$("#"+c).removeClass("leftCard").addClass("rightCard").css("z-index",Q).css("right","0px"),C||(""!==i.ill?$("#"+c+" .card_illustrator_name").removeClass("display_none").addClass("display_block").html("").html(constant.illustratedBy+i.ill):$("#"+c+" .card_illustrator_name").removeClass("display_block").addClass("display_none").html(""),$("#"+c+" .card_enlarge_image").css("background-image","url("+i.l_img+")")),U=!1})}}function y(){var a=0,e=0,l=O,s=0,r={},i={},o={},d=L-1,t=A[d],n=0,c=!1,_=!1;if(deviceInfo.isMobile){var p=q.width();a=p<400?p:400}else a=$("#card_enlarge_container").width();for(var C=0;C<t.length;C++)if(l===t[C].id){n=C;break}if($("#enlarge_next_bt").removeClass("display_none").addClass("display_block"),$("#enlarge_prev_bt").removeClass("display_none").addClass("display_block"),$("#card_enlarge1").css("z-index",J).css("right",a+"px").removeClass("centerCard rightCard").addClass("leftCard").attr("data-value",e),$("#card_enlarge2").css("z-index",K).css("right","0px").removeClass("leftCard rightCard").addClass("centerCard").attr("data-value",l),$("#card_enlarge3").css("z-index",Q).css("right","0px").removeClass("leftCard centerCard").addClass("rightCard").attr("data-value",s),$("#card_enlarge_foil1").removeClass("display_block").addClass("display_none"),$("#card_enlarge_foil2").removeClass("display_block").addClass("display_none"),$("#card_enlarge_foil3").removeClass("display_block").addClass("display_none"),$("#card_enlarge_illustrator1").removeClass("display_block").addClass("display_none").html(""),$("#card_enlarge_illustrator2").removeClass("display_block").addClass("display_none").html(""),$("#card_enlarge_illustrator3").removeClass("display_block").addClass("display_none").html(""),W){var m=parseInt($("#list_virus_bt").attr("data-value"),10);m>1e4&&(m%=1e4),o=masterVirus[m],l=O>=1e4&&24!=o.species?m+1e4:m}else o=masterCard[l%1e4];t.length<=1?(c=!0,_=!0,$("#enlarge_prev_bt").removeClass("display_block").addClass("display_none"),$("#enlarge_next_bt").removeClass("display_block").addClass("display_none")):n<=0?(c=!0,$("#enlarge_prev_bt").removeClass("display_block").addClass("display_none"),s=t[n+1].id,i=masterCard[s%1e4]):n+1>=t.length?(_=!0,$("#enlarge_next_bt").removeClass("display_block").addClass("display_none"),e=t[n-1].id,r=masterCard[e%1e4]):(e=t[n-1].id,r=masterCard[e%1e4],s=t[n+1].id,i=masterCard[s%1e4]),""!==o.ill&&$("#card_enlarge_illustrator2").removeClass("display_none").addClass("display_block").html("").html(constant.illustratedBy+o.ill),""!==r.ill&&$("#card_enlarge_illustrator1").removeClass("display_none").addClass("display_block").html("").html(constant.illustratedBy+r.ill),""!==i.ill&&$("#card_enlarge_illustrator3").removeClass("display_none").addClass("display_block").html("").html(constant.illustratedBy+i.ill),$("#card_enlarge_image2").css("background-image","url("+o.l_img+")"),c||$("#card_enlarge_image1").css("background-image","url("+r.l_img+")"),_||$("#card_enlarge_image3").css("background-image","url("+i.l_img+")"),e>=1e4&&$("#card_enlarge_foil1").removeClass("display_none").addClass("display_block"),l>=1e4&&$("#card_enlarge_foil2").removeClass("display_none").addClass("display_block"),s>=1e4&&$("#card_enlarge_foil3").removeClass("display_none").addClass("display_block"),$("#card_enlarge_wrapper").removeClass("display_none").addClass("display_block")}function k(){$("#card_enlarge_wrapper").removeClass("display_block").addClass("display_none")}function x(){var a=0;R>1&&(L>1?L--:L=R,a=L-1,F(A[a]),$("#cardbox_page_num").html("").html(L),$("#sub_page_num").html("").html(L))}function w(){var a=0;R>1&&(L<R?L++:L=1,a=L-1,F(A[a]),$("#cardbox_page_num").html("").html(L),$("#sub_page_num").html("").html(L))}function B(){var a=$(this),e=0;W=!1,e=Number(a.attr("data-id")),O=e,D(O)}function D(a){var e=!1,l=!1;deviceInfo.isMobile||P||(l=!0);for(var s=0;s<j.length;s++)if(j[s].id===a){e=!0;break}N.cardDetailDialog(a,e,l)}function I(){$.ajax({url:"/get_card_list_info",dataType:"json",success:function(a,e,s){if(0===a.result)return void location.reload();j=a.userCardInfo,userFavCards=a.userFavCards,$("#filter_favo_den").html("").html(maxFavNum),$("#filter_favo_num").html("").html(userFavCards.length);var r;r=setInterval(function(){Object.keys(masterCard).length>0&&(clearInterval(r),S(),l())},1e3)},error:function(){}})}function S(){var a=[],e=[],l=[];for(var s in masterCard){var r=parseInt(masterCard[s].id,10),i={id:0,cnt:null};i.id=r;for(var o=0;o<j.length;o++)if(j[o].id===r){i.cnt=j[o].cnt;break}(null!==i.cnt||r<1e4)&&e.push(i)}for(var o=0;o<j.length;o++){var i={id:j[o].id,cnt:j[o].cnt};j[o].id>=1e4&&e.push(i)}A=[],R=0,L=1,e=e.filter(T.searchFilter),e=e.filter(T.filterCardBox),e=T.sortCardBox(e);for(var o=0;o<e.length;o++)o%E===0&&(a=[],R++),a.push(e[o]),a.length!==E&&o+1!==e.length||A.push(a);A.length>1?($("#left_s_bt").removeClass("disable"),$("#right_s_bt").removeClass("disable"),$("#sub_menu_page_left").removeClass("disable"),$("#sub_menu_page_right").removeClass("disable")):(R=1,$("#left_s_bt").addClass("disable"),$("#right_s_bt").addClass("disable"),$("#sub_menu_page_left").addClass("disable"),$("#sub_menu_page_right").addClass("disable")),l=0!==A.length?A[0]:[],F(l),$("#cardbox_page_den").html("").html(R),$("#sub_page_den").html("").html(R),$("#loading_wrapper").addClass("display_none")}function F(a){var e="",l=!0,s=!1;if(0!==a.length){O=a[0].id;for(var r=0;r<a.length;r++){var i="",o=a[r].id,d=o%1e4,t=a[r].cnt,n=masterCard[d].s_img,c=masterCard[d].imgClass,_="",p="",C={id:0,cnt:0,isMove:!1},m="",g="";o>=1e4&&(m="display_block"),_=masterCard[d].sprite?'<div class="card_image '+c+'"></div> ':'<div class="card_image" style="background:url('+n+') no-repeat;background-size:100%;"></div>',null!==t?g='<div class="card_quantity">x'+t+"</div>":(p="display_block",O==o&&(l=!1)),i='<li id="cardbox_'+o+'" data-value="'+C+'" data-id="'+o+'">'+_+'<div class="foil '+m+'"></div><div class="darken '+p+'"></div> '+g+"</li>",e+=i}}else O=0;deviceInfo.isMobile||(s=!0,N.cardDetailDialog(O,l,s)),$("#cardbox_page_num").html("").html(L),$("#sub_page_num").html("").html(L),$("#cardbox_card").html("").html(e)}function M(){searchWord=$("#p_card_search").val(),S()}var T=new cardBoxToolsClass,z=new BulletinBoardClass,N=new commonClass,W=!1,j=[],A=[],E=100,L=1,R=0,O=0,P=!1,X=$("body"),q=$(window);$("#p_bottom_wrapper").addClass("card_list_bottom"),z.getOrderBoardInfo(),a(),localStorage.foilCardDispType||(localStorage.foilCardDispType=constant.foilCardDispType.PARALLEL),localStorage.cardBoxCardCount||(localStorage.cardBoxCardCount=1),localStorage.cardBoxDispNational||(localStorage.cardBoxDispNational=0),E=constant.cardBoxCardCount[parseInt(localStorage.cardBoxCardCount,10)],foilCardDispType=parseInt(localStorage.foilCardDispType,10),!deviceInfo.isMobile&&q.height()<=700&&(P=!0,X.addClass("low_window_pc")),q.resize(function(){deviceInfo.isMobile||($("#card_detail_wrapper").removeClass("display_block").addClass("display_none"),q.height()<=700?(P=!0,X.addClass("low_window_pc")):(P=!1,X.removeClass("low_window_pc")))});var H=!1,V=0,G=0;$("#card_enlarge_wrapper").on("touchstart",function(a){H=!1,V=a.originalEvent.changedTouches[0].pageX}),$("#card_enlarge_wrapper").on("touchmove",function(){H=!0}),$("#card_enlarge_wrapper").on("touchend",function(a){G=a.originalEvent.changedTouches[0].pageX,H&&(V<G?b():h()),H=!1});var J=3,K=2,Q=1,U=!1;$("#enlarge_prev_bt").on("click",b),$("#enlarge_next_bt").on("click",h)});