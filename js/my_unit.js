"use strict";var currentUnitTag=0,selectUnitTag=0,userMp=0,masterUnit=[],purchasePresent={},userUnitInfo={},selectPresentIndex=0,currentDialog=0,isActiveEvent=!0,now=new Date,message={MP_SHORTAGE:"MPが不足しています。"},dialog={CLOSE:"CLOSE",FIRST_UNIT_SELECT_P1:"FIRST_UNIT_SELECT_P1",FIRST_UNIT_SELECT_P2:"FIRST_UNIT_SELECT_P2",FIRST_UNIT_SELECT_P3:"FIRST_UNIT_SELECT_P3",FIRST_UNIT_SELECT_P4:"FIRST_UNIT_SELECT_P4",PURCHASE_UNIT_P1:"PURCHASE_UNIT_P1",PURCHASE_UNIT_P2:"PURCHASE_UNIT_P2",PURCHASE_UNIT_P3:"PURCHASE_UNIT_P3",PURCHASE_PRESENT_P1:"PURCHASE_PRESENT_P1",PURCHASE_PRESENT_P2:"PURCHASE_PRESENT_P2",PURCHASE_PRESENT_P3:"PURCHASE_PRESENT_P3",PURCHASE_PRESENT_P4:"PURCHASE_PRESENT_P4",CONTEST_P1:"CONTEST_P1",CONTEST_P2:"CONTEST_P2",CONTEST_P3:"CONTEST_P3",CONTEST_P4:"CONTEST_P4",VERSION_ERROR:"VERSION_ERROR",SESSION_ERROR:"SESSION_ERROR",EXCEPTION_ERROR:"EXCEPTION_ERROR",GAME_ROGIN_ERROR:"GAME_ROGIN_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",MP_SHORTAGE:"MP_SHORTAGE",ROGIN_MESSAGE:"ROGIN_MESSAGE",OTHERS:"OTHERS"},click="click",responseStatus={SUCCESS:"SUCCESS",SESSION_ERROR:"SESSION_ERROR",PRESENT_SOLD_OUT:"PRESENT_SOLD_OUT",PLAY_VERSION_ERROR:"PLAY_VERSION_ERROR",GAME_LOGIN_ERROR:"GAME_LOGIN_ERROR",MP_SHORTAGE:"MP_SHORTAGE",VALIDATION_ERROR:"VALIDATION_ERROR",EXCEPTION_ERROR:"EXCEPTION_ERROR"};$(function(){function e(){if($("#event_popup_cancel").on(click,E),$("#event_popup_close").on(click,S),$("#event_popup_decline").on(click,T),$("#event_popup_accept").on(click,h),$("#event_popup_next").on(click,C),$("#event_popup_back").on(click,y),deviceInfo.isMobile){P.mobileBtnHover($("#paging_prev_bt")),P.mobileBtnHover($("#paging_next_bt")),P.mobileBtnHover($("#unit_main_bt")),P.mobileBtnHover($("#unit_present_bt")),P.mobileBtnHover($("#unit_buy_bt")),P.mobileBtnHover($("#unit_contest_bt")),P.mobileBtnHover($("#event_popup_back")),P.mobileBtnHover($("#event_popup_close")),P.mobileBtnHover($("#event_popup_accept")),P.mobileBtnHover($("#event_popup_decline")),P.mobileBtnHover($("#event_popup_cancel")),P.mobileBtnHover($("#event_popup_next"));for(var e=0;e<purchasePresent.length;e++)P.mobileBtnHover($("#present_list_"+e+" .select_plate"));for(var e=0;e<masterUnit.length;e++)P.mobileBtnHover($("#first_select_unit_"+e+" .select_plate")),P.mobileBtnHover($("#purchase_unit_"+e+" .select_plate"))}}function n(){var e="";$(".action_select_area ul").text("");for(var n=0;n<masterUnit.length;n++){var t="unit_image_"+masterUnit[n].tag+"_1";e+='<li id="first_select_unit_'+n+'" data-unit="'+masterUnit[n].tag,e+=0===masterUnit[n].mp?'" class="disable">':'">',e+='<span class="select_plate"><span class="select_name">'+masterUnit[n].name+"</span>",0===masterUnit[n].mp&&(e+='<span class="unit_gray_out"></span><span class="unit_hold display_none"></span>'),e+='<div class="'+t+'"></div></span></li>'}currentDialog=dialog.FIRST_UNIT_SELECT_P1,$(".action_select_area ul").html(e),$("#first_select_area").on(click,"li",d),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#first_action_container").removeClass("display_none"),$("#event_popup_cancel").removeClass("display_none"),$("#event_popup_next").removeClass("display_none"),$("#first_p1").removeClass("display_none"),$("#event_popup_wrapper").removeClass("display_none").addClass("display_block")}function t(){currentDialog=dialog.ROGIN_MESSAGE,(new CommonDialogClass).DisplayDialog(N,{close:!0})}function s(){currentDialog===dialog.ROGIN_MESSAGE&&i(function(){isActiveEvent=!0}),deviceInfo.isMobile&&$("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none"),P.resetDialogInfo(),$("#popup_container").html(""),currentDialog=dialog.CLOSE,R&&a()}function a(){var e={uk:uk};$.ajax({url:"/myunit_dialog_read",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){return isActiveEvent=!0,e.status!==responseStatus.SUCCESS?void P.error(e.status):void(R=!1)},error:function(e,n,t){isActiveEvent=!0,R=!1,P.error(responseStatus.EXCEPTION_ERROR)}})}function i(e){0!==Object.keys(userUnitInfo).length&&userUnitInfo[currentUnitTag]&&(u(userUnitInfo[currentUnitTag]),_(userUnitInfo[currentUnitTag].comment,function(){if(null!=e)return e()}))}function o(e){currentDialog=dialog.PURCHASE_PRESENT_P1;for(var n in purchasePresent){var t="present_list_"+n;purchasePresent[n].isSoldOut?($("#"+t).addClass("disable"),$("#"+t+" .unit_sold_out").removeClass("display_none")):userMp<purchasePresent[n].mp&&($("#"+t).addClass("disable"),$("#"+t+" .unit_mp_short").removeClass("display_none"))}return g(),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#present_action_container").removeClass("display_none"),$("#present_p1").removeClass("display_none"),$("#event_popup_close").removeClass("display_none"),e()}function r(){if(isActiveEvent){isActiveEvent=!1,currentDialog=dialog.PURCHASE_UNIT_P1;var e=$("#buy_select_area li");e.each(function(){for(var e=$(this).attr("data-unit"),n=!0,t={},s=0;s<masterUnit.length;s++)e===masterUnit[s].tag&&(t=masterUnit[s]);userUnitInfo[e]?(n=!1,$(this).find(".unit_hold").removeClass("display_none")):userMp<t.mp&&(n=!1,$(this).find(".unit_mp_short").removeClass("display_none")),n?$(this).removeClass("disable"):$(this).addClass("disable")}),g(),$("#buy_p1").removeClass("display_none"),$("#buy_action_container").removeClass("display_none"),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#event_popup_close").removeClass("display_none"),isActiveEvent=!0}}function l(){if(isActiveEvent){isActiveEvent=!1;var e="",n=0,t=0;n=userUnitInfo[currentUnitTag].contestConsumptionMp,t=userMp-n,t>=0?(currentDialog=dialog.CONTEST_P1,e=userUnitInfo[currentUnitTag].name,$("#contest_unit").html("").html(e),$("#contest_user_mp").html("").html(b.numberToStringNumber(userMp)),$("#contest_send_mp").html("").html(b.numberToStringNumber(n)),$("#contest_sum_mp").html("").html(b.numberToStringNumber(t)),g(),$("#event_popup_wrapper").addClass("contest"),$("#contest_p1").removeClass("display_none"),$("#contest_action_container").removeClass("display_none"),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#event_popup_accept").removeClass("display_none"),$("#event_popup_decline").removeClass("display_none")):(currentDialog=dialog.MP_SHORTAGE,(new CommonDialogClass).DisplayDialog(message.MP_SHORTAGE,{close:!0})),isActiveEvent=!0}}function _(e,n){var t=e.split(""),s=t.length,a=0,i="";$("#unit_comment_info").html("").addClass("display_none"),$("#unit_comment_text").html("");var o=setInterval(function(){if(a<s)i+=";"===t[a]?"<br>":t[a],$("#unit_comment_text").html(i);else if(clearInterval(o),$("#unit_touch_area").off(),$("#unit_touch_area").on(click,c),n)return n();a++},50);$("#unit_touch_area").off(click),$("#unit_touch_area").on(click,function(){i="";for(var e=0;e<s;e++)i+=";"===t[e]?"<br>":t[e];if($("#unit_comment_text").html(i),clearInterval(o),$("#unit_touch_area").off(),$("#unit_touch_area").on(click,c),n)return n()})}function p(e){if(isActiveEvent){isActiveEvent=!1;var n={},t=[];clearInterval(w);for(var s=0;s<masterUnit.length;s++)for(var a in userUnitInfo)if(masterUnit[s].tag==a){t.push(a);break}"prev"===e&&t.reverse();for(var s=0;s<t.length;s++)if(currentUnitTag===t[s]){currentUnitTag=null!=t[s+1]?t[s+1]:t[0];break}n=userUnitInfo[currentUnitTag],A.fadeOut(300,function(){u(n),_(n.comment,function(){isActiveEvent=!0})})}}function u(e){for(var n=now.getDate,t="",s="",a=0,i="--",o="--",r="",l=0,_="",p=0,u=0,c=0,d="",m=0;m<e.medals.length;m++){var v='<div class="'+e.medals[m].img+'">'+e.medals[m].text+"</div>";d+=v}$("#unit_ranking_medal_box").html(d),$("#my_unit_present").addClass("display_none"),selectUnitTag==e.tag?$("#unit_main_bt").addClass("selected"):$("#unit_main_bt").removeClass("selected");for(var f="",m=0;m<e.friendlyInfo.effectNum;m++)f+='<div id="level_effect_'+e.friendlyInfo.effect+"_"+(m+1)+'" class="effect_position_'+(m+1)+'"></div>';$("#unit_level_effect").html("").html(f),t=e.name,_=e.flavor,i=e.favorPt,u=e.displayTouchNum,a=e.friendlyInfo.lv,l=a>=999?100:e.friendlyInfo.ratio,p=e.mood,s="unit_image_"+e.tag+"_"+p,c=e.contestConsumptionMp,1!==n&&(o=e.rank),r=e.maxRank,$("#unit_friendly_level").html(a),$("#unit_name").html(t),$("#touch_count").html(u),$("#unit_mood span").removeClass().addClass("mood_"+p),$("#unit_friendly_bar").css("width",l+"%"),A.removeClass().addClass(s),$("#unit_popularity_point").html(b.numberToStringNumber(i)),P.isMonthStart()?$("#unit_rank").html("").html("--"):$("#unit_rank").html("").html(o),$("#unit_flavor_text").html(_),$("#contest_mp span").html("").html(b.numberToStringNumber(c)),$("#unit_best_rank").html("").html(r),A.fadeIn(300)}function c(){isActiveEvent&&(isActiveEvent=!1,f($("#unit_image"),function(){if("isTouch"in userUnitInfo[currentUnitTag]&&userUnitInfo[currentUnitTag].isTouch===!1)return _(userUnitInfo[currentUnitTag].comment,function(){isActiveEvent=!0});userUnitInfo[currentUnitTag].touchNum<1&&(userUnitInfo[currentUnitTag].isTouch=!1);var e={uk:uk,unitTag:currentUnitTag,touchNum:userUnitInfo[currentUnitTag].touchNum,fp:userUnitInfo[currentUnitTag].friendlyInfo.pt};$.ajax({url:"/comment",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){return e.status!==responseStatus.SUCCESS?(P.error(e.status),void(isActiveEvent=!0)):(userUnitInfo[currentUnitTag].comment=e.comment,$("#my_unit_present").addClass("display_none"),_(e.comment,function(){e.isReward||(isActiveEvent=!0);var n="",t=e.levelUpNum,s=0,a=$("#unit_lvup");if(0!==e.getFriendlyPoint){n="【仲良しポイント"+e.getFriendlyPoint+"ポイントゲット！】",$("#unit_comment_info").removeClass(),$("#unit_comment_info").html(n),e.friendlyInfo.lv>=999?$("#unit_friendly_bar").css("width","100%"):$("#unit_friendly_bar").css("width",e.friendlyInfo.ratio+"%"),$("#touch_count").html(e.displayTouchNum);var i=0,o=0,r=0;if(0!=e.friendlyInfo.effect||0!=e.friendlyInfo.effectNum){if(userUnitInfo[currentUnitTag].friendlyInfo.effect===e.friendlyInfo.effect)userUnitInfo[currentUnitTag].friendlyInfo.effectNum!==e.friendlyInfo.effectNum&&(o=userUnitInfo[currentUnitTag].friendlyInfo.effectNum+1,r=e.friendlyInfo.effectNum-userUnitInfo[currentUnitTag].friendly_info.effectNum);else{var l=userUnitInfo[currentUnitTag].friendlyInfo.effect,p=userUnitInfo[currentUnitTag].friendlyInfo.effectNum;o=1,r=e.friendlyInfo.effectNum;for(var u=0;u<p;u++){var c=u+1,d=$("#level_effect_"+l+"_"+c);m(d)}}if(r>0){i=e.friendlyInfo.effect;for(var u=0;u<r;u++){var f=o+u;$("#unit_level_effect").append('<div id="level_effect_'+i+"_"+f+'" class="display_none effect_position_'+f+'"></div>'),v($("#level_effect_"+i+"_"+f))}}}userUnitInfo[currentUnitTag].friendlyInfo.pt=e.friendlyInfo.pt,e.friendlyInfo.lv>=999?userUnitInfo[currentUnitTag].friendlyInfo.ratio=100:userUnitInfo[currentUnitTag].friendlyInfo.ratio=e.friendlyInfo.ratio,userUnitInfo[currentUnitTag].touchNum=e.touchNum,userUnitInfo[currentUnitTag].displayTouchNum=e.displayTouchNum,t>0&&(userUnitInfo[currentUnitTag].friendlyInfo.lv=e.friendlyInfo.lv,userUnitInfo[currentUnitTag].friendlyInfo.effect=e.friendlyInfo.effect,userUnitInfo[currentUnitTag].friendlyInfo.effectNum=e.friendlyInfo.effectNum,userUnitInfo[currentUnitTag].flavor=e.flavor,$("#unit_friendly_level").html(e.friendlyInfo.lv),$("#unit_flavor_text").html(e.flavor)),clearInterval(w),t>0&&(w=setInterval(function(){s++,a.css("top","").css("display","none"),a.css("display","block").animate({top:"-5px",opacity:"1"},100,"swing",function(){setTimeout(function(){a.fadeOut("fast",function(){a.css("top","")})},400)}),t<=s&&clearInterval(w)},400)),e.isReward&&setTimeout(function(){_(e.rewardComment,function(){$("#unit_comment_info").html("").html(e.rewardText).removeClass("display_none"),isActiveEvent=!0}),$("#my_unit_present").removeClass("display_none square_present").addClass("display_block rectangle_present"),v($("#my_unit_present"))},500)}}),void 0)},error:function(e,n,t){isActiveEvent=!0,P.error(responseStatus.EXCEPTION_ERROR)}})}))}function d(){if(!$(this).hasClass("disable")){currentDialog=dialog.FIRST_UNIT_SELECT_P3;var e=$(this).attr("data-unit"),n={};D=e;for(var t=0;t<masterUnit.length;t++)D===masterUnit[t].tag&&(n=masterUnit[t]);var s="unit_image_"+D+"_1";$("#first_unit_image_p3").removeClass().addClass(s),$("#first_unit").html("").html(n.name),g(),$("#action_button_area").addClass("first_p3"),$("#event_popup_accept").removeClass("display_none"),$("#event_popup_decline").removeClass("display_none"),$("#first_p2").addClass("display_none"),$("#first_p3").removeClass("display_none"),$("#first_action_container").removeClass("display_none")}}function m(e){var n=Number(e.css("top").replace("px","")),t=Number(e.css("left").replace("px","")),s=Number(e.css("width").replace("px","")),a=Number(e.css("height").replace("px","")),i={height:"0px",width:"0px",left:t+s/2+"px",top:n+a/2+"px"};e.animate(i,500,"swing",function(){})}function v(e){var n=Number(e.css("top").replace("px","")),t=Number(e.css("left").replace("px","")),s=Number(e.css("width").replace("px","")),a=Number(e.css("height").replace("px","")),i=15*s/10,o=15*a/10,r=n-(o-a)/2,l=t-(i-s)/2,_={height:"0px",width:"0px",left:l+i/2+"px",top:r+o/2+"px"},p={height:o+"px",width:i+"px",top:r,left:l},u={height:a+"px",width:s+"px",top:n,left:t};e.removeClass("display_none").css(_),e.animate(p,500,"swing",function(){e.animate(u,500,"swing",function(){})})}function f(e,n){var t=Number(e.css("top").replace("px","")),s=Number(e.css("left").replace("px","")),a=Number(e.css("width").replace("px","")),i=Number(e.css("height").replace("px","")),o=95*i/100,r=95*a/100,l=t-(o-i)/2;l+=(i-o)/2;var _=s-(r-a)/2,p=10,u=106*i/100,c=106*a/100,d=t-(u-i)/2;d-=(u-i)/2+p;var m=s-(c-a)/2,v={height:i+"px",width:a+"px"},f={height:o+"px",width:r+"px",top:l,left:_},g={height:u+"px",width:c+"px",top:d,left:m},C={height:i+"px",width:a+"px",top:t,left:s};e.removeClass("display_none").css(v),e.animate(f,100,"swing",function(){e.animate(g,100,"swing",function(){e.animate(C,100,"swing",function(){return n()})})})}function g(){$("#first_action_container").addClass("display_none"),$("#first_p1").addClass("display_none"),$("#first_p2").addClass("display_none"),$("#first_p3").addClass("display_none"),$("#first_p4").addClass("display_none"),$("#present_action_container").addClass("display_none"),$("#present_p1").addClass("display_none"),$("#present_p2").addClass("display_none"),$("#present_p3").addClass("display_none"),$("#present_p4").addClass("display_none"),$("#buy_action_container").addClass("display_none"),$("#buy_p1").addClass("display_none"),$("#buy_p2").addClass("display_none"),$("#buy_p3").addClass("display_none"),$("#event_popup_wrapper").removeClass("contest"),$("#contest_action_container").addClass("display_none"),$("#contest_p1").addClass("display_none"),$("#contest_p2").addClass("display_none"),$("#contest_p3").addClass("display_none"),$("#dialog_main_text").html(""),$("#unit_dialog_container").addClass("display_none"),$("#action_button_area").removeClass(),$("#event_popup_back").addClass("display_none"),$("#event_popup_close").addClass("display_none"),$("#event_popup_accept").addClass("display_none"),$("#event_popup_decline").addClass("display_none"),$("#event_popup_cancel").addClass("display_none"),$("#event_popup_next").addClass("display_none")}function C(){isActiveEvent&&(isActiveEvent=!1,currentDialog===dialog.FIRST_UNIT_SELECT_P1?(currentDialog=dialog.FIRST_UNIT_SELECT_P2,g(),$("#first_action_container").removeClass("display_none"),$("#first_p2").removeClass("display_none"),$("#event_popup_back").removeClass("display_none"),$("#event_popup_cancel").removeClass("display_none"),isActiveEvent=!0):isActiveEvent=currentDialog===dialog.PURCHASE_PRESENT_P3||(currentDialog===dialog.CONTEST_P2,!0))}function y(){isActiveEvent&&(isActiveEvent=!1,currentDialog===dialog.FIRST_UNIT_SELECT_P2&&(currentDialog=dialog.FIRST_UNIT_SELECT_P1,g(),$("#first_action_container").removeClass("display_none"),$("#first_p1").removeClass("display_none"),$("#event_popup_next").removeClass("display_none"),$("#event_popup_cancel").removeClass("display_none"),isActiveEvent=!0))}function E(){isActiveEvent&&(isActiveEvent=!1,window.scroll(0,0),currentDialog!==dialog.FIRST_UNIT_SELECT_P1&&currentDialog!==dialog.FIRST_UNIT_SELECT_P2||(window.location.href="/information",isActiveEvent=!0))}function T(){if(isActiveEvent)if(isActiveEvent=!1,window.scroll(0,0),currentDialog===dialog.FIRST_UNIT_SELECT_P3)currentDialog=dialog.FIRST_UNIT_SELECT_P2,g(),$("#first_action_container").removeClass("display_none"),$("#first_p2").removeClass("display_none"),$("#event_popup_back").removeClass("display_none"),$("#event_popup_cancel").removeClass("display_none"),isActiveEvent=!0;else if(currentDialog===dialog.PURCHASE_PRESENT_P2)currentDialog=dialog.PURCHASE_PRESENT_P1,g(),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#present_action_container").removeClass("display_none"),$("#present_p1").removeClass("display_none"),$("#event_popup_close").removeClass("display_none"),isActiveEvent=!0;else if(currentDialog===dialog.CONTEST_P1)currentDialog=dialog.CLOSE,g(),$("#event_popup_wrapper").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup"),isActiveEvent=!0;else if(currentDialog===dialog.PURCHASE_UNIT_P2){currentDialog=dialog.PURCHASE_UNIT_P1;var e=$("#buy_select_area li");e.each(function(){for(var e=$(this).attr("data-unit"),n=0,t=0;t<masterUnit.length;t++)if(e===masterUnit[t].tag){n=masterUnit[t].mp;break}userUnitInfo[e]?$(this).find(".unit_hold").removeClass("display_none"):userMp<n&&$(this).find(".unit_mp_short").removeClass("display_none")}),g(),$("#buy_p1").removeClass("display_none"),$("#buy_action_container").removeClass("display_none"),$("#event_popup_wrapper").removeClass("display_none"),deviceInfo.isMobile&&$("body").addClass("popup"),$("#event_popup_close").removeClass("display_none"),isActiveEvent=!0}}function h(){if(isActiveEvent)if(isActiveEvent=!1,currentDialog===dialog.FIRST_UNIT_SELECT_P3){var e={uk:uk,unitTag:D};$.ajax({url:"/first_unit_select",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){if(e.status!==responseStatus.SUCCESS)return $("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),isActiveEvent=!0,void P.error(e.status);var s=e.unitInfo;currentDialog=dialog.FIRST_UNIT_SELECT_P4,e.isGetLoginBonus&&""!==e.messageHtml&&(N=e.messageHtml),userUnitInfo[D]=s,g();var a="unit_image_"+D+"_1";userMp=e.mp,$("#unit_mission_point span").html(b.numberToStringNumber(userMp)),$("#first_add_unit").html("").html(s.name),$("#first_unit_comment").html("").html(s.comment.replace(/;/g,"<br/>")),$("#first_unit_image_p4").removeClass().addClass(a),$("#first_action_container").removeClass("display_none"),$("#first_p4").removeClass("display_none"),$("#event_popup_close").removeClass("display_none"),currentUnitTag=s.tag,selectUnitTag=s.tag,u(s),isActiveEvent=!0},error:function(e,n,t){isActiveEvent=!0,$("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),P.error(responseStatus.EXCEPTION_ERROR)}})}else{if(currentDialog===dialog.PURCHASE_PRESENT_P2)return;if(currentDialog===dialog.CONTEST_P1)return;if(currentDialog===dialog.PURCHASE_UNIT_P2){var e={uk:uk,unitTag:k,userMp:userMp};$.ajax({url:"/purchase_unit",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){if(e.status!==responseStatus.SUCCESS)return isActiveEvent=!0,$("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),void P.error(e.status);currentDialog=dialog.PURCHASE_UNIT_P3;var s="unit_image_"+k+"_1";userMp=e.mp,$("#unit_mission_point span").html(b.numberToStringNumber(userMp)),$("#buy_unit_image_p3").removeClass().addClass(s),$("#buy_unit_comment").html("").html(e.unitInfo.comment.replace(/;/g,"<br>")),$("#buy_add_unit").html("").html(e.unitInfo.name),g(),$("#buy_action_container").removeClass("display_none"),$("#buy_p3").removeClass("display_none"),$("#event_popup_close").removeClass("display_none"),currentUnitTag=e.unitInfo.tag,userUnitInfo[currentUnitTag]=e.unitInfo,($("#paging_prev_bt").hasClass("disable")||$("#paging_next_bt").hasClass("disable"))&&($("#paging_prev_bt").removeClass("disable"),$("#paging_next_bt").removeClass("disable")),isActiveEvent=!0},error:function(e,n,t){return isActiveEvent=!0,$("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),P.error(responseStatus.EXCEPTION_ERROR),callback()}})}}}function S(){isActiveEvent&&(window.scroll(0,0),isActiveEvent=!1,currentDialog===dialog.FIRST_UNIT_SELECT_P4?(currentDialog=dialog.CLOSE,$("#event_popup_wrapper").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup"),g(),""!==N?t():i(function(){isActiveEvent=!0})):currentDialog===dialog.PURCHASE_UNIT_P3||currentDialog===dialog.CONTEST_P2?($("#event_popup_wrapper").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup"),g(),i(function(){isActiveEvent=!0}),currentDialog=dialog.CLOSE):currentDialog===dialog.ROGIN_MESSAGE?(deviceInfo.isMobile&&$("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none"),P.resetDialogInfo(),$("#popup_container").html(""),g(),i(function(){isActiveEvent=!0}),I(),currentDialog=dialog.CLOSE):currentDialog===dialog.PURCHASE_PRESENT_P4?($("#event_popup_wrapper").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup"),g(),u(userUnitInfo[currentUnitTag]),_(userUnitInfo[currentUnitTag].comment,function(){"isReturnPresent"in userUnitInfo[currentUnitTag]&&userUnitInfo[currentUnitTag].isReturnPresent===!0?setTimeout(function(){v($("#my_unit_present")),_(userUnitInfo[currentUnitTag].returnPresentComment,function(){isActiveEvent=!0,$("#unit_comment_info").html("").html(userUnitInfo[currentUnitTag].returnPresentText).removeClass("display_none")})},500):isActiveEvent=!0}),currentDialog=dialog.CLOSE):currentDialog===dialog.VERSION_ERROR?(currentDialog=dialog.CLOSE,window.location.href="/information",isActiveEvent=!0):currentDialog===dialog.SESSION_ERROR?(currentDialog=dialog.CLOSE,window.location.href="/",isActiveEvent=!0):currentDialog===dialog.EXCEPTION_ERROR||currentDialog===dialog.VALIDATION_ERROR?(currentDialog=dialog.CLOSE,location.reload(),isActiveEvent=!0):(currentDialog=dialog.CLOSE,$("#event_popup_wrapper").addClass("display_none"),deviceInfo.isMobile&&$("body").removeClass("popup"),g(),isActiveEvent=!0))}function U(){if(isActiveEvent&&!$("#unit_main_bt").hasClass("selected")){isActiveEvent=!1;var e={uk:uk,unitTag:currentUnitTag};$.ajax({url:"/set_unit",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){return e.status!==responseStatus.SUCCESS?(isActiveEvent=!0,void P.error(e.status)):($("#my_unit_present").addClass("display_none"),userUnitInfo[e.unitTag].isTouch=!0,selectUnitTag=e.unitTag,userUnitInfo[e.unitTag].comment=e.comment,_(e.comment,function(){isActiveEvent=!0}),$("#unit_main_bt").addClass("selected"),void 0)},error:function(e,n,t){isActiveEvent=!0,P.error(responseStatus.EXCEPTION_ERROR)}})}}function I(){var e={uk:uk};$.ajax({url:"/myunit_dialog_read",contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST",timeout:2e4,success:function(e,n,t){if(e.status!==responseStatus.SUCCESS)return void P.error(e.status)},error:function(e,n,t){P.error(responseStatus.EXCEPTION_ERROR)}})}var b=new MyUnitModule,R=!1,P=new commonClass,N="",O=[],A=$("#unit_image");document.onkeydown=function(){if(9===event.keyCode)return!1},deviceInfo.isMobile&&(O=[]);for(var M=0;M<O.length;M++){var x=new Image;x.src=O[M]}isActiveEvent=!1,$.ajax({url:"/get_unit_info",cache:!1,type:"GET",timeout:2e4,success:function(s,a,i){if(window.scroll(0,0),s.status!==responseStatus.SUCCESS)return void P.error(s.status);N=s.messageHtml,selectUnitTag=s.selectUnitTag,currentUnitTag=s.selectUnitTag,userMp=s.mp,R=s.isExistFirstMonthMessage,userUnitInfo=s.userUnit,masterUnit=s.masterUnit,purchasePresent=s.purchasePresent,0===Object.keys(userUnitInfo).length?(isActiveEvent=!0,n()):""!==N?t():userUnitInfo[selectUnitTag]&&(u(userUnitInfo[selectUnitTag]),_(userUnitInfo[selectUnitTag].comment,function(){isActiveEvent=!0})),$("#unit_mission_point span").html(b.numberToStringNumber(userMp)),$("#ranking_number").html("").html(s.rankInfo.num),$("#ranking_period").html("").html(s.rankInfo.term),Object.keys(userUnitInfo).length>1?($("#paging_prev_bt").removeClass("disable"),$("#paging_next_bt").removeClass("disable")):($("#paging_prev_bt").addClass("disable"),$("#paging_next_bt").addClass("disable"));for(var c="",d=0;d<masterUnit.length;d++){var m="unit_image_"+masterUnit[d].tag+"_1",v=b.numberToStringNumber(masterUnit[d].mp);c+='<li id="purchase_unit_'+d+'" data-unit="'+masterUnit[d].tag+'"><span class="select_plate"><span class="select_name">'+masterUnit[d].name+'</span><div class="'+m+'"></div><span class="unit_price">'+v+'MP</span><span class="unit_gray_out"></span><span class="unit_hold display_none"></span><span class="unit_mp_short display_none"></span></span></li>'}$("#buy_select_area ul").html("").html(c);for(var f="",d=0;d<purchasePresent.length;d++){var g=purchasePresent[d];f+='<li id="present_list_'+d+'" data-present="'+d+'"><span class="select_plate"><span class="present_img_'+g.iconType+'"></span><span class="select_name">'+g.name+'</span><span class="select_mp">'+g.mp+'MP</span><span class="unit_gray_out"></span><span class="unit_sold_out display_none"></span><span class="unit_mp_short display_none"></span></span></li>'}$("#present_select_area ul").html("").html(f),$("#paging_prev_bt").on(click,function(){$("#paging_prev_bt").hasClass("disable")||$("#paging_next_bt").hasClass("disable")||p("prev")}),$("#paging_next_bt").on(click,function(){$("#paging_prev_bt").hasClass("disable")||$("#paging_next_bt").hasClass("disable")||p("next")}),$("#unit_present_bt").on("click",function(){isActiveEvent&&(isActiveEvent=!1,o(function(){isActiveEvent=!0}))}),$("#unit_buy_bt").on("click",r),$("#unit_contest_bt").on("click",l),e()},error:function(e,n,t){P.error(responseStatus.EXCEPTION_ERROR)}}),$("#common_popup_close").on("click",s);var k=0;$("#buy_select_area").on(click,"li",function(){var e=$(this).attr("data-unit"),n=0,t="";k=e;for(var s=0;s<masterUnit.length;s++)if(k===masterUnit[s].tag){n=masterUnit[s].mp,t=masterUnit[s].name;break}if(!(userUnitInfo[k]||userMp<n)){currentDialog=dialog.PURCHASE_UNIT_P2,g();var a="unit_image_"+k+"_1",i=userMp-n;$("#buy_user_mp").html("").html(b.numberToStringNumber(userMp)),$("#buy_send_mp").html("").html(b.numberToStringNumber(n)),$("#buy_sum_mp").html("").html(b.numberToStringNumber(i)),$("#buy_unit").html("").html(t),$("#buy_unit_image_p2").removeClass().addClass(a),$("#buy_action_container").removeClass("display_none"),$("#buy_p2").removeClass("display_none"),$("#event_popup_accept").removeClass("display_none"),$("#event_popup_decline").removeClass("display_none")}}),$("#present_select_area ul").on({mouseenter:function(){var e=$(this).attr("data-present"),n=purchasePresent[e].mp,t=0;t=userMp-n,purchasePresent[e].isSoldOut||userMp<purchasePresent[e].mp||$(".select_plate",this).addClass("active")},mouseleave:function(){$(".select_plate",this).removeClass("active")}},"li"),$("#buy_select_area ul").on({mouseenter:function(){for(var e=$(this).attr("data-unit"),n={},t=0;t<masterUnit.length;t++)e===masterUnit[t].tag&&(n=masterUnit[t]);userUnitInfo[e]||userMp<n.mp||$(".select_plate",this).addClass("active")},mouseleave:function(){$(".select_plate",this).removeClass("active")}},"li"),$("#first_select_area ul").on({mouseenter:function(){$(this).hasClass("disable")||$(".select_plate",this).addClass("active")},mouseleave:function(){$(this).hasClass("disable")||$(".select_plate",this).removeClass("active")}},"li"),$("#present_select_area ul").on(click,"li",function(){currentDialog=dialog.PURCHASE_PRESENT_P2,selectPresentIndex=$(this).attr("data-present");var e=userUnitInfo[currentUnitTag].name,n=purchasePresent[selectPresentIndex].name,t=purchasePresent[selectPresentIndex].mp,s=0;s=userMp-t,purchasePresent[selectPresentIndex].isSoldOut||userMp<purchasePresent[selectPresentIndex].mp||($("#present_unit").html("").html(e),$("#present_name").html("").html(n),$("#present_send_mp").html("").html(b.numberToStringNumber(t)),$("#present_user_mp").html("").html(b.numberToStringNumber(userMp)),$("#present_sum_mp").html("").html(b.numberToStringNumber(s)),g(),$("#present_action_container").removeClass("display_none"),$("#present_p2").removeClass("display_none"),$("#event_popup_accept").removeClass("display_none"),$("#event_popup_decline").removeClass("display_none"))});var w=0;$("#unit_touch_area").on(click,c);var D=0;$("#unit_main_bt").on(click,U)});var MyUnitModule=function(){};MyUnitModule.prototype.getPurchaseResult=function(e){var n=this,t=new commonClass,s=$("#unit_image"),a=purchasePresent[selectPresentIndex].id,i={uk:uk,unitTag:currentUnitTag,presentId:a,userMp:userMp};$.ajax({url:"/purchase_present",contentType:"application/json",dataType:"json",data:JSON.stringify(i),type:"POST",timeout:2e4,success:function(a,i,o){if(a.status===responseStatus.SUCCESS){currentDialog=dialog.PURCHASE_PRESENT_P3;var r="unit_image_"+a.unitTag+"_1",l="unit_image_"+a.unitTag+"_"+a.mood,_="mood_"+a.mood,p=userUnitInfo[a.unitTag].name,u=a.isReturnPresent,c="";if(purchasePresent[selectPresentIndex].isSoldOut=a.isSoldOut,c=a.presentName,n.resetDialogInfo(),userUnitInfo[a.unitTag].isTouch=!0,a.addMedal){for(var d="",m=0;m<a.addMedal.length;m++){for(var v=!1,f=0;f<userUnitInfo[a.unitTag].medals.length;f++)a.addMedal[m].img===userUnitInfo[a.unitTag].medals[f].img&&(v=!0);if(!v){userUnitInfo[a.unitTag].medals.push(a.addMedal[m]);var g='<div class="'+a.addMedal[m].img+'">'+a.addMedal[m].text+"</div>";d+=g}}$("#unit_ranking_medal_box").html(d)}return userMp=a.mp,$("#present_result_touch").addClass("display_none"),$("#present_result_mood").addClass("display_none"),$("#unit_mission_point span").html(n.numberToStringNumber(userMp)),$("#present_action_container").removeClass("display_none"),$("#present_p3").removeClass("display_none"),$("#event_popup_next").removeClass("display_none"),$("#present_unit_comment").html("").html(a.comment.replace(/;/g,"<br>")),$("#present_unit_image").removeClass().addClass(r),$("#present_result_unit").html("").html(p),$("#result_mood").removeClass().addClass(_),$("#present_result_name").html("").html(c),$("#result_touch span").html("").html(a.displayTouchNum),s.removeClass().addClass(l),userUnitInfo[a.unitTag].touchNum!=a.touchNum&&$("#present_result_touch").removeClass("display_none"),userUnitInfo[a.unitTag].mood!=a.mood&&$("#present_result_mood").removeClass("display_none"),userUnitInfo[a.unitTag].mood=a.mood,userUnitInfo[a.unitTag].touchNum=a.touchNum,userUnitInfo[a.unitTag].displayTouchNum=a.displayTouchNum,userUnitInfo[a.unitTag].comment=a.comment,userUnitInfo[a.unitTag].isReturnPresent=u,userUnitInfo[a.unitTag].returnPresentComment=a.returnPresentComment,userUnitInfo[a.unitTag].returnPresentText=a.returnPresentText,e(null)}return $("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),void t.error(a.status)},error:function(n,s,a){return $("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),t.error(responseStatus.EXCEPTION_ERROR),e(n)}})},MyUnitModule.prototype.getContestResult=function(e){var n=this,t=new commonClass,s={uk:uk,unitTag:currentUnitTag,userMp:userMp,consumptionMp:userUnitInfo[currentUnitTag].contestConsumptionMp};$.ajax({url:"/get_contest_result",contentType:"application/json",dataType:"json",data:JSON.stringify(s),type:"POST",timeout:2e4,success:function(s,a,i){return s.status===responseStatus.SUCCESS?(currentDialog=dialog.CONTEST_P2,
userUnitInfo[currentUnitTag].isTouch=!0,$("#contest_unit_comment").html("").html(s.comment.replace(/;/g,"<br>")),$("#contest_get_pt").html("").html(s.getFavorPoint),userUnitInfo[s.unitTag].comment=s.comment,userUnitInfo[s.unitTag].contestConsumptionMp=s.nextConsumptionMp,userUnitInfo[s.unitTag].favorPt=s.favorPoint,userMp=s.mp,$("#unit_mission_point span").html(n.numberToStringNumber(userMp)),n.resetDialogInfo(),$("#contest_comment_frame").css("display","none"),$(".action_foot_text").css("display","none"),$("#event_popup_wrapper").addClass("contest"),$("#contest_action_container").removeClass("display_none"),$("#contest_p2").removeClass("display_none"),$("#event_popup_next").removeClass("display_none"),e(null,s.contestResult)):($("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),t.error(s.status),e(s.status))},error:function(n,s,a){return $("#event_popup_wrapper").removeClass("display_block").addClass("display_none"),t.error(responseStatus.EXCEPTION_ERROR),e(n)}})},MyUnitModule.prototype.afterPurchasePresentAnimation=function(){var e=this;currentDialog=dialog.PURCHASE_PRESENT_P4,e.resetDialogInfo(),$("#present_action_container").removeClass("display_none"),$("#present_p4").removeClass("display_none"),$("#event_popup_close").removeClass("display_none")},MyUnitModule.prototype.resetDialogInfo=function(e){$("#first_action_container").addClass("display_none"),$("#first_p1").addClass("display_none"),$("#first_p2").addClass("display_none"),$("#first_p3").addClass("display_none"),$("#first_p4").addClass("display_none"),$("#present_action_container").addClass("display_none"),$("#present_p1").addClass("display_none"),$("#present_p2").addClass("display_none"),$("#present_p3").addClass("display_none"),$("#present_p4").addClass("display_none"),$("#buy_action_container").addClass("display_none"),$("#buy_p1").addClass("display_none"),$("#buy_p2").addClass("display_none"),$("#buy_p3").addClass("display_none"),$("#event_popup_wrapper").removeClass("contest"),$("#contest_action_container").addClass("display_none"),$("#contest_p1").addClass("display_none"),$("#contest_p2").addClass("display_none"),$("#contest_p3").addClass("display_none"),$("#dialog_main_text").html(""),$("#unit_dialog_container").addClass("display_none"),$("#action_button_area").removeClass(),$("#event_popup_back").addClass("display_none"),$("#event_popup_close").addClass("display_none"),$("#event_popup_accept").addClass("display_none"),$("#event_popup_decline").addClass("display_none"),$("#event_popup_cancel").addClass("display_none"),$("#event_popup_next").addClass("display_none")},MyUnitModule.prototype.numberToStringNumber=function(e){var n="";return n=String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};