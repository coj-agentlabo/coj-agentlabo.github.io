"use strict";$(function(){function e(){var e={};sortType=constant.sort.num.id,setTimeout(H,0),xa=location.search.substring(1).split("&");for(var a=0;xa[a];a++){var s=xa[a].split("=");e[s[0]]=s[1]}"id"in e&&(la=parseInt(e.id,10)),"recipe"in e&&(ja=!0,m()),deviceInfo.isMobile||(ca=2),$("#cv_analyze_deck").addClass("display_none"),$("#menu_detail").removeClass("display_block").addClass("display_none"),$("#p_deck_element").removeClass(),$("#m_card_search").val(constant.defaultSearchWord),deviceInfo.isMobile||(Qe.cardDetailDialog(ga,!0,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")),K(),Xe.applyCardBoxFilter()}function a(){for(var e=JSON.parse(sessionStorage.dr),a="",s=$("#dob_threshold_tbody"),o=0,l=e.length;o<l;o++)a+="<tr>",a+="<th>"+e[o].tag.toUpperCase()+"</th>",a+=e[o].ep==-1?"<th>"+e[o].p+" - </th>":"<th>"+e[o].p+" - "+e[o].ep+"</th>",a+="<th>"+e[o].pointRatio.toFixed(1)+"倍</th>",a+="</tr>";s.empty().append(a)}function s(){if(deviceInfo.isMobile){var e=40,a=$(window).height(),s=$("#deck_area").height()+e,o=a-s;$("#cardbox_contents").css("height",o)}}function o(){$("#cardbox_joker").on("click","li",ye),$("#p_deck_dob_bt").on("click",c),$("#dob_threshold_close").on("click",p),$("#deck_filter_regulation_bt").on("click",Z),$("#deck_clear_bt").on("click",se),$("#cardbox_card").on("click","li",_e),$("#deck_card").on("click","li",me),$("#deck_card").on("click",pe),$("#deck_1st").on("click",ue),$("#deck_2nd").on("click",fe),$("#menu_detail_bt").on("click",x),$("#deck_move_frame").on("click",Ie),$("#deck_area").on("scroll",ke),$("#cardbox_contents").on("scroll",Ce),$("#card_detail_text").on("click",be),$("#deck_sort_bt").on("click",R),$("#detail_favo_bt").on("click",I),$("#deck_copy_bt").on("click",Je),$("#deck_paste_bt").on("click",Ke),$("#cardbox_move_frame").on("click",we),$("#deck_verify_regulation_bt").on("click",z),$("#regulation_close_bt").on("click",B),$("#analyze_bt").on("click",N),$("#analyze_close_bt").on("click",D),$("#analyze_next_bt").on("click",T),$("#analyze_prev_bt").on("click",A),$("#deck_selector").change(w),$("#close_filter_bt").on("click",Re),$("#deck_save_bt").on("click",Me),$("#common_popup_accept").on("click",Le),$("#common_popup_decline").on("click",ze),$("#common_popup_close").on("click",Be),$("#detail_virus_bt").on("click",S),$('#filter_list input[type="checkbox"]').on("change",V),$("#regulation_tab").on("click",E),Ta.on("click",l),$("#deck_bt_recipe").on("click",m),$("#bt_deck_recipe_close").on("click",C),$("#bt_deck_recipe_cancel").on("click",f),$("#bt_deck_recipe_prev").on("click",y),$("#bt_deck_recipe_next").on("click",y),$("#bt_deck_recipe_deck_editor").on("click",b),$("#bt_deck_recipe_registration").on("click",u),$("#deck_recipe_wrapper").on("click",".deck_recipe_lists",We),$("#detail_order_board_bt").on("click",n),$("#order_board_popup_cancel").on("click",Ye.CloseDialog),$("#bt_order_board_popup_want_normal").on("click",r),$("#bt_order_board_popup_want_foil").on("click",i),$("#bt_order_board_popup_release_normal").on("click",t),$("#bt_order_board_popup_release_foil").on("click",d),deviceInfo.isMobile?($("#sub_menu_sort_save").on("click",Ee),$("#m_deck_dob_bt").on("click",_),$("#deck_row_bt").on("click",xe),$("#sub_menu_search_filter").on("click",he),$("#m_card_search_text").focus(Xe.focusSearchBox),$("#m_card_search_text").blur(Xe.blurSearchBox),$("#submit_bt").on("click",O),$("#sub_menu_page_left").on("click",ce),$("#sub_menu_page_right").on("click",de),$(".bt_arrow").on("click",g),Qe.mobileBtnHover($("#sub_menu_search_filter")),Qe.mobileBtnHover($("#sub_menu_sort_save")),Qe.mobileBtnHover($("#sub_menu_page_left")),Qe.mobileBtnHover($("#sub_menu_page_right")),Qe.mobileBtnHover($("#analyze_bt")),Qe.mobileBtnHover($("#deck_copy_bt")),Qe.mobileBtnHover($("#deck_paste_bt")),Qe.mobileBtnHover($("#deck_verify_regulation_bt")),Qe.mobileBtnHover($("#deck_filter_regulation_bt")),Qe.mobileBtnHover($("#deck_save_bt")),Qe.mobileBtnHover($("#deck_clear_bt")),Qe.mobileBtnHover($("#deck_sort_bt")),Qe.mobileBtnHover($("#submit_bt")),Qe.mobileBtnHover($("#close_filter_bt")),Qe.mobileBtnHover($("#regulation_close_bt")),Qe.mobileBtnHover($("#analyze_next_bt")),Qe.mobileBtnHover($("#analyze_prev_bt")),Qe.mobileBtnHover($("#analyze_close_bt"))):($("#filter_wrapper").on("click",Re),$("#p_card_detail_frame_top").on("click",J),$("#select_filter_bt").on("click",M),$("#p_card_sort_type").change(h),$("#left_s_bt").on("click",ce),$("#right_s_bt").on("click",de),$("#p_card_search").focus(Xe.focusSearchBox),$("#p_card_search").blur(Xe.blurSearchBox),$("#p_card_search").keyup(Fe)),$(document).on("click",function(e){var a=$(e.target);deviceInfo.isMobile&&(ha!=constant.menu.open||a.closest("#deck_pallete").length||a.closest("#sub_menu_sort_save").length||Ee())})}function l(){var e=$(".op_bg"),a=$(".cp_bg");za===La.CP?(za=La.OP,Ta.removeClass("bt_sub_param_cp bt_sub_param_hide").addClass("bt_sub_param_p"),e.removeClass("display_none").addClass("display_block"),a.removeClass("display_block").addClass("display_none")):za===La.OP?(za=La.NONE,Ta.removeClass("bt_sub_param_cp bt_sub_param_p").addClass("bt_sub_param_hide"),a.removeClass("display_block").addClass("display_none"),e.removeClass("display_block").addClass("display_none")):za===La.NONE&&(za=La.CP,Ta.removeClass("bt_sub_param_p bt_sub_param_hide").addClass("bt_sub_param_cp"),a.removeClass("display_none").addClass("display_block"),e.removeClass("display_block").addClass("display_none")),localStorage.cardSubParamType=za}function n(){Oa=Da,Da=Sa.BULLETIN_BOARD,Ye=new BulletinBoardClass(ga),Ye.DisplayDialog()}function r(){Ye.ClickWantCardNormalButton()}function i(){Ye.ClickWantCardFoilButton()}function t(){Ye.ClickReleaseCardNormalButton()}function d(){Ye.ClickReleaseCardFoilButton()}function c(){$("#dob_threshold_wrapper").hasClass("display_none")&&$("#dob_threshold_wrapper").removeClass("display_none").addClass("display_block")}function _(){$("#dob_threshold_wrapper").hasClass("display_none")&&$("#dob_threshold_wrapper").removeClass("display_none").addClass("display_block"),$("body").hasClass("popup")||$("body").addClass("popup")}function p(){$("#dob_threshold_wrapper").hasClass("display_block")&&$("#dob_threshold_wrapper").removeClass("display_block").addClass("display_none"),deviceInfo.isMobile&&$("body").hasClass("popup")&&$("body").removeClass("popup")}function m(){0===Object.keys(Na).length?$.ajax({url:"/get_deck_recipe_info",dataType:"json",success:function(e){Na=e.userDeckRecipeInfo,k(),v()},error:function(){Qe.error(constant.responseStatus.EXCEPTION_ERROR)}}):v()}function v(){deviceInfo.isMobile&&($("body").hasClass("popup")||$("body").addClass("popup")),ha==constant.menu.open&&Ee(),te(),Oa=Da,Da=Sa.DECK_RECIPE_LIST,$("#deck_recipe_wrapper").removeClass("display_none").addClass("display_block"),$("#deck_recipe_list").removeClass("display_none").addClass("display_block"),$("#recipe_list_p1").removeClass("display_none").addClass("display_block"),$("#recipe_list_p2").removeClass("display_block").addClass("display_none"),$("#deck_recipe_preview").removeClass("display_block").addClass("display_none")}function k(){for(var e="",a="",s=0,o=Na.cardSetList.length;s<o;s++)e+='<li class="deck_recipe_lists" data-id="'+Na.cardSetList[s].deckId+'"><img src="/img/deck_recipe/'+Na.cardSetList[s].deckRecipeImgName+'">',Na.cardSetList[s].isNew&&(e+='<span id="deck_recipe_new_ic" class="ic_new"></span>'),e+="</li>";if($("ul","#recipe_list_p2").html("").html(e),0===Na.presentList.length)a='<span class="recipe_none_text">プレゼントレシピが存在しません。</span>';else for(var s=0,o=Na.presentList.length;s<o;s++)a+='<li class="deck_recipe_lists" data-id="'+Na.presentList[s].deckId+'"><img src="/img/deck_recipe/'+Na.presentList[s].deckRecipeImgName+'">',Na.presentList[s].isNew&&(a+='<span id="deck_recipe_new_ic" class="ic_new"></span>'),a+="</li>";$("ul","#recipe_list_p1").html("").html(a)}function C(){ja?location.href="/deck_list":(deviceInfo.isMobile&&$("body").hasClass("popup")&&$("body").removeClass("popup"),Oa=Da,Da=Sa.CLOSE,$("#deck_recipe_wrapper").removeClass("display_block").addClass("display_none"),$("#deck_recipe_list").removeClass("display_block").addClass("display_none"),$("#deck_recipe_preview").removeClass("display_block").addClass("display_none"))}function b(){Q(),oe(),le(),na&&ee(),deviceInfo.isMobile&&$("body").removeClass("popup"),ja=!1,Oa=Da,Da=Sa.CLOSE,$("#deck_recipe_preview").removeClass("display_block").addClass("display_none"),$("#deck_recipe_list").removeClass("display_block").addClass("display_none"),$("#deck_recipe_wrapper").removeClass("display_block").addClass("display_none")}function u(){deviceInfo.isMobile&&$("body").removeClass("popup"),$("#deck_recipe_preview").removeClass("display_block").addClass("display_none"),$("#deck_recipe_list").removeClass("display_block").addClass("display_none"),$("#deck_recipe_wrapper").removeClass("display_block").addClass("display_none"),Oa=Da,Q(),oe(),le(),Me()}function f(){switch(Pa){case 1:$("#recipe_list_p1").removeClass("display_none").addClass("display_block");break;case 2:$("#recipe_list_p2").removeClass("display_none").addClass("display_block");break;default:location.href="error"}oa=ta,ia[1]=da[1],ia[2]=da[2],Q(),oe(),le(),na&&ee(),$("#deck_recipe_list").removeClass("display_none").addClass("display_block"),$("#deck_recipe_preview").removeClass("display_block").addClass("display_none")}function y(){$("#recipe_list_p1").hasClass("display_block")?($("#recipe_list_p1").removeClass("display_block").addClass("display_none"),$("#title_present_recipe").removeClass("display_block").addClass("display_none"),$("#recipe_list_p2").removeClass("display_none").addClass("display_block"),$("#title_card_recipe").removeClass("display_none").addClass("display_block")):($("#recipe_list_p2").removeClass("display_block").addClass("display_none"),$("#title_card_recipe").removeClass("display_block").addClass("display_none"),$("#recipe_list_p1").removeClass("display_none").addClass("display_block"),$("#title_present_recipe").removeClass("display_none").addClass("display_block"))}function g(){var e=$(this),a=e.attr("data-val"),s=$("#filter_"+a);if(s.hasClass("open"))s.removeClass("open").addClass("close");else if(s.removeClass("close").addClass("open"),"foil"===a){var o=$("#filter_list").get(0).scrollHeight,l=$("#filter_list").height(),n=o-l;$("#filter_list").animate({scrollTop:n})}}function h(){te(),oe()}function R(){te(),Q(),na&&ee()}function x(){if(Ra==constant.edit.card){var e=!0,a=parseInt($(".invalid_card","#deck_"+ga).attr("data-value"),10),s=$(".card_quantity","#deck_"+ga).html();"undefined"!=typeof s&&(s=parseInt(s.slice(1),10),"undefined"!=typeof a&&s<=a&&(e=!1)),Qe.cardDetailDialog(ga,e,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")}else Qe.jokerDetailDialog(ga)}function E(){$("#detail_SP_tab").removeClass("on").addClass("off"),$("#detail_flavor_tab").removeClass("on").addClass("off"),$("#regulation_tab").removeClass("off").addClass("on"),$("#card_detail_SP").removeClass("display_block").addClass("display_none"),$("#card_detail_flavor").removeClass("display_block").addClass("display_none"),$("#regulation_info").removeClass("display_none").addClass("display_block"),$("#voice_info").removeClass("display_block").addClass("display_none")}function I(){Oa=Da,Da=Sa.FAVORITE,Qe.changeFavorite(ga)}function S(){var e=parseInt($(this).attr("data-value"),10),a=$("#card_detail_foil").hasClass("display_block");null!=e&&0!==e&&($(this).hasClass("bt_virus")?(Qe.cardDetailDialog(e,!1,!1,a,!0),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")):(Qe.cardDetailDialog(ga,!0,!1,a,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")))}function O(){var e=$("#m_card_search_text").val();e==constant.defaultSearchWord?searchWord="":searchWord=e,Xe.applyCardBoxFilter(),oe(),$("body").removeClass("popup"),$("#filter_wrapper").removeClass("display_block").addClass("display_none")}function D(){deviceInfo.isMobile&&$("body").removeClass("popup"),$("#analyze_wrapper").removeClass("display_block").addClass("display_none"),$("#analyze_deck_img").removeClass("display_none").addClass("display_block"),$("#analyze_graph").removeClass("display_block").addClass("display_none")}function w(){te(),pa={},la=parseInt($("#deck_selector").val(),10);for(var e=0;e<_a.length;e++)if(la==_a[e].deckId){oa=_a[e].card,ia[1]=_a[e].jokerAbility[1],ia[2]=_a[e].jokerAbility[2];break}Q(),oe(),le(),na&&ee()}function T(){Ba>=Object.keys(constant.analyzePage).length?Ba=1:Ba++,$(".analyze_header").html("").html(constant.analyzePage[Ba].name),"img"==constant.analyzePage[Ba].tag?($("#analyze_deck_img").removeClass("display_none").addClass("display_block"),$("#analyze_graph").removeClass("display_block").addClass("display_none")):(j(),P(constant.analyzePage[Ba].tag))}function A(){1==Ba?Ba=Object.keys(constant.analyzePage).length:Ba--,$(".analyze_header").html("").html(constant.analyzePage[Ba].name),"img"==constant.analyzePage[Ba].tag?($("#analyze_deck_img").removeClass("display_none").addClass("display_block"),$("#analyze_graph").removeClass("display_block").addClass("display_none")):(j(),P(constant.analyzePage[Ba].tag))}function P(e){var a=0,s="",o=0,l=0,n=0,r=0;r=Ma[e].graph.length,$("#graph_caption").html("").html(Ma[e].caption),a=100/parseInt(r,10);for(var i=0;i<Ma[e].graph.length;i++){for(var t=Ma[e].graph[i].xAxisText,d="",c=Ma[e].graph[i].stack,_="",p=0,m=0;m<c.length;m++)for(var v=constant.color[c[m].color].tag,k=c[m].ids,C=0;C<k.length;C++)p<Ze&&(_+='<div class="bar_'+v+' graph_cell" style=""></div>',p++);p>o&&(o=p);var b="",u="";if(deviceInfo.isMobile){var f=280,y=Math.floor(f/r);b="height",u='<div class="x_axis" style="height: '+y+'px">'+t+"</div>"}else{var g=630,h=Math.floor(g/r);b="width",u='<div class="x_axis" style="width: '+h+'px">'+t+"</div>"}d='<div class="bar_data" style="'+b+": "+a+'%"><div class="bar"><div class="cells">'+_+"</div></div>"+u+"</div>",s+=d}o<=constant.graphStackSize.large.maxNum?(n=constant.graphStackSize.large.width,l=constant.graphStackSize.large.height):o<=constant.graphStackSize.medium.maxNum?(n=constant.graphStackSize.medium.width,l=constant.graphStackSize.medium.height):(n=constant.graphStackSize.small.width,l=constant.graphStackSize.small.height),$("#bar_area").html("").html(s),$("#analyze_deck_img").removeClass("display_block").addClass("display_none"),$("#analyze_graph").removeClass("display_none").addClass("display_block"),deviceInfo.isMobile?($(".medium_bar .graph_cell").css("width",0),$(".medium_bar .graph_cell").animate({width:n+"px"},500)):($(".medium_bar .graph_cell").css("height",0),$(".medium_bar .graph_cell").animate({height:l+"px"},500))}function j(){for(var e=0,a=8,s=1e3,o=9e3,l=1e3,n={},r={},i={},t=0,d=0,c=0,_=0,p=0,m=0,v=0;v<oa.length;v++){var k=oa[v].id,C=oa[v].cnt,b=k%1e4,u=masterCard[b],f=u.color,y=u.cost,g=u.bp1,$=u.species,h=u.species2;g>o&&(g=o),n[y]||(n[y]={}),n[y][f]||(n[y][f]=[]),r[g]||(r[g]={}),r[g][f]||(r[g][f]=[]),i[$]||(i[$]={}),i[$][f]||(i[$][f]=[]),i[h]||(i[h]={}),i[h][f]||(i[h][f]=[]);for(var R=0;R<C;R++)"ユニット"!=constant.type[u.type].text&&"進化"!=constant.type[u.type].text||d++,t++,c+=y,_+=u.bp1,y>=a&&(y=a,n[y]||(n[y]={}),n[y][f]||(n[y][f]=[])),n[y][f].push(k),r[g][f].push(k),i[$][f].push(k),h>0&&i[h][f].push(k)}p=t>0&&c>0&&t>0?Math.round(c/t*10)/10:"0.0",m=t>0&&_>0&&d>0?Math.round(_/d*10)/10:"0.0",Ma.cp.graph=[],Ma.bp1.graph=[],Ma.species.graph=[],Ma.cp.caption="平均CP : "+p,Ma.bp1.caption="平均BP : "+m;for(var v=e;v<=a;v++){var y=v,x=[],E={xAxisText:"",stack:[]};if(y in n)for(var I in n[y]){var S={color:I,ids:n[y][I]};x.push(S)}v<a?E.xAxisText="CP"+y:E.xAxisText="CP"+y+"以上",E.stack=x,Ma.cp.graph.push(E)}for(var v=s;v<=o;v+=l){var g=v,O=[],D={xAxisText:"",stack:[]};if(g in r)for(var I in r[g]){var w={color:I,ids:r[g][I]};O.push(w)}D.xAxisText=g+"～",D.stack=O,Ma.bp1.graph.push(D)}for(var T in constant.species)if("ウィルス"!==constant.species[T].text&&"竜"!==constant.species[T].text&&"亜竜"!==constant.species[T].text){var A=[],P={xAxisText:"",stack:[]};if(constant.species[T].id in i)for(var j in i[constant.species[T].id]){var N={color:j,ids:i[constant.species[T].id][j]};A.push(N)}P.xAxisText=constant.species[T].text,P.stack=A,Ma.species.graph.push(P)}}function N(){$("#analyze_wrapper").removeClass("display_none").addClass("display_block"),L("analyze_deck")}function L(e){function a(e,a,o,l,i){var d=0,c=0,p=1,k=l%r;p=Math.floor((l-1)/r+1),e.onload=function(){if(0==k&&(k=r),d=(k-1)*m+20,c=(p-1)*v+_,n.drawImage(e,d,c,m,v),o?n.drawImage(g,d,c,m,v):a&&n.drawImage(y,d,c,m,v),t++,t==Ze){Aa.removeClass("display_none").addClass("display_none"),deviceInfo.isMobile&&($("#pallete_wrapper").removeClass("display_block").addClass("display_none"),$("body").addClass("popup"));var l=s.toDataURL();document.getElementById("img_"+i).src=l}}}var s=document.getElementById("cv_"+e),o="",l="",n=s.getContext("2d"),r=0,i=0,t=0,d=new Image,c=0,_=0,p=0,m=0,v=0,k=0,C=0,b=0,u=0,f=0,y=null,g=null,h=null;g=new Image,g.src="img/pc/deck/invalid_card_recipe.png",g.onload,y=new Image,y.src="img/pc/foil/foil_thum.png",y.onload=function(){Ba=1,$(".analyze_header").html("").html(constant.analyzePage[Ba].name),te(),deviceInfo.isMobile?(r=8,c=1120,p=1210,_=10,m=135,v=190,k=340,C=340,b=1055,u=1155,f=40,d.src="/img/mobile/deck/analyze/canvas_bg.png"):(r=10,c=1240,p=900,_=26,m=120,v=169,k=170,C=810,b=838,u=838,f=28,d.src="/img/pc/deck/analyze/canvas_bg.png"),$("#cv_"+e).attr("width",c),$("#cv_"+e).attr("height",p),document.getElementById("img_"+e).src="",Aa.css("z-index","1000").removeClass("display_none").addClass("display_block");for(var s=0;s<userJokerInfo.length;s++){var t=userJokerInfo[s];t.id==ia[1]?o=t.abilityName:t.id==ia[2]&&(l=t.abilityName)}o&&l?$("#bt_deck_recipe_registration").removeClass("bt_no_registration"):$("#bt_deck_recipe_registration").addClass("bt_no_registration"),d.onload=function(){n.drawImage(d,0,0,c,p),n.fillStyle="rgb(255, 255, 255)",n.font=f+'px "sans-serif"',n.fillText(o,k,b),n.fillText(l,C,u);for(var s=0,r={},t=0;t<userCardInfo.length;t++)r[userCardInfo[t].id]=$.extend(!0,[],userCardInfo[t]);for(var t=0;t<oa.length;t++){var _=oa[t].id,m=_%1e4,v=!1,y=0,g=oa[t].cnt;s+=g,_ in r?(r[_].cnt<g&&(y=g-r[_].cnt,g-=y),_>=1e4&&(v=!0)):(y=g,g=0);for(var R=0;R<g&&i<Ze;R++){i++;var x=new Image;x.src=masterCard[m].s_img,a(x,v,!1,i,e)}for(var R=0;R<y&&i<Ze;R++){i++;var x=new Image;x.src=masterCard[m].s_img,a(x,!1,!0,i,e)}}if(s!==Ze)for(var E=Ze-s,t=0;t<E;t++)h=new Image,h.src="img/pc/list/card_back.jpg",x=h,i++,a(x,!1,!1,i,e)}}}function z(){deviceInfo.isMobile&&(Ee(),$("body").addClass("popup")),$("#regulation_wrapper").removeClass("display_none").addClass("display_block")}function B(){deviceInfo.isMobile&&$("body").removeClass("popup"),$("#regulation_wrapper").removeClass("display_block").addClass("display_none")}function M(){te(),Xe.displayPcFilter()}function V(){var e=$(this);Xe.changeFilterCheckBox(e),oe()}function J(){te(),$("#regulation_tab").removeClass("display_block").addClass("display_none"),$("#detail_SP_tab").removeClass("off").addClass("on"),$("#detail_flavor_tab").removeClass("on").addClass("off"),$("#regulation_tab").removeClass("on").addClass("off"),$("#card_detail_SP").removeClass("display_none").addClass("display_block"),$("#card_detail_flavor").removeClass("display_block").addClass("display_none"),$("#regulation_info").removeClass("display_block").addClass("display_none"),$("#voice_info").removeClass("display_block").addClass("display_none"),ba==constant.menu.open?(ba=constant.menu.close,$("#card_detail_wrapper").removeClass("open").addClass("close"),$("#cardbox_area").removeClass("open").addClass("close")):(ba=constant.menu.open,$("#card_detail_wrapper").removeClass("close").addClass("open"),$("#cardbox_area").removeClass("close").addClass("open"))}function K(){var e="",a=[];for(var s in constant.sort)a.push(constant.sort[s]);a.sort(function(e,a){return e.id<a.id?-1:e.id>a.id?1:0});for(var o=0;o<a.length;o++){var l=a[o].id,n=a[o].text;e+='<option value="'+l+'">'+n+"</option>"}$("#m_card_sort_type").html("").html(e),$("#p_card_sort_type").html("").html(e)}function H(){$.ajax({url:"/get_deck_editor_info",dataType:"json",success:function(e){if(0==e.result)return void location.reload();userJokerInfo=e.userJokerInfo,sa=e.selectDeckId,userCardInfo=e.userCardInfo,userFavCards=e.userFavCards,_a=e.userDeckInfo,aa=e.isDisplayDeckRank,va.contents=e.eventInfo.contents,va.isRegulation=e.eventInfo.isRegulation,va.regulationExplanation=e.eventInfo.regulationExplanation,va.regulation=e.eventInfo.regulation,ka=e.compatiableCardInfo,va.isRegulation&&$("#deck_filter_regulation_bt").removeClass("disable"),za==La.OP?Ta.removeClass("bt_sub_param_cp bt_sub_param_hide").addClass("bt_sub_param_p"):za==La.CP?Ta.removeClass("bt_sub_param_p bt_sub_param_hide").addClass("bt_sub_param_cp"):za==La.NONE&&Ta.removeClass("bt_sub_param_cp bt_sub_param_p").addClass("bt_sub_param_hide"),va.regulationDeckRank=e.eventInfo.regulationDeckRank,va.regulationDeckRankType=e.eventInfo.regulationDeckRankType,va.regulationCardPoint=e.eventInfo.regulationCardPoint,va.regulationCardPointType=e.eventInfo.regulationCardPointType,va.regulationCard=e.eventInfo.regulationCard,(va.isRegulation||va.regulationCardPointType!=-1)&&(ra=!0),null==la&&(la=sa);for(var a="",s=0;s<_a.length;s++){var l="",n="",r="";la==_a[s].deckId&&(oa=_a[s].card,ia[1]=_a[s].jokerAbility[1],ia[2]=_a[s].jokerAbility[2],n=" selected"),sa==_a[s].deckId&&(r="*"),l='<option value="'+_a[s].deckId+'"'+n+">"+_a[s].deckName+r+"</option>",a+=l}$("#deck_selector").html("").html(a),$("#filter_favo_den").html("").html(ea),$("#filter_favo_num").html("").html(userFavCards.length),$("#regulation_text_top").html("").html(va.contents);var i;i=setInterval(function(){Object.keys(masterCard).length>0&&(clearInterval(i),Q(),oe(),le(),o())},1e3)},error:function(){Qe.error(constant.responseStatus.EXCEPTION_ERROR)}})}function G(e){var a=!0;if(va.regulationCardPointType!=-1){var s=e%1e4,o=masterCard[s].op;0==va.regulationCardPointType&&o<va.regulationCardPoint?a=!1:1==va.regulationCardPointType&&o<=va.regulationCardPoint?a=!1:2==va.regulationCardPointType&&o>=va.regulationCardPoint?a=!1:3==va.regulationCardPointType&&o>va.regulationCardPoint?a=!1:4==va.regulationCardPointType&&o==va.regulationCardPoint?a=!1:5==va.regulationCardPointType&&o!=va.regulationCardPoint&&(a=!1)}else a=!1;return a}function F(e){var a="display_none",s="display_none",o="";return za===La.CP?a="display_block":za===La.OP&&(s="display_block"),o="img/cards/joker/thum/joker_"+e.jokerTag+".jpg",'<div class="card_image" style="background: url('+o+'); background-size: 60px;"></div><div class="sub_parameter cp_bg '+a+'">'+e.cp+'</div><div class="sub_parameter op_bg '+s+'">'+e.op+'</div><div class="joker_char '+e.agentTag+'"></div><div class="joker_no no'+e.no+'"></div>'}function W(e,a){for(var s={tempDeckList:{},shortageCardList:{}},o=0;o<e.length;o++){var l=parseInt(e[o].id,10),n=parseInt(e[o].cnt,10),r=0;s.tempDeckList[l]=n,l in a&&(r=parseInt(a[l].cnt,10)),n>r&&(s.shortageCardList[l]=n-r),l in a&&(a[l].cnt=a[l].cnt-s.tempDeckList[l],a[l].cnt<0&&(a[l].cnt=0))}return s}function U(e,a,s){var o={tempDeckList:{},shortageDeckCards:{}};for(var l in e){var n=parseInt(l,10),r=0,i=parseInt(e[n],10),t=!1;n<1e4?r=n+1e4:(r=n-1e4,t=!0),n in a||(a[n]={},a[n].cnt=0),r in a&&a[r].cnt>0?(r in s||(s[r]=0),i>a[r].cnt?t?(s[n]=2,s[r]=1,pa[n]=1,pa[r]=0):(s[n]=1,s[r]=2,pa[n]=0,pa[r]=1):(s[n]=s[n]-i,s[r]+=i)):pa[n]=i}return o.shortageDeckCards=pa,o.tempDeckList=s,o}function q(e){var a=[];for(var s in e){var o=parseInt(s,10);if(o%1e4 in masterCard){var l=parseInt(e[s],10),n={id:o,cnt:l};a.push(n)}}return a}function X(e){var a="";oa=[];for(var s=0;s<e.length;s++){var o=parseInt(e[s].cnt,10);if(o>0){var l=parseInt(e[s].id,10),n="",r=0;oa.push(e[s]),l in pa&&(r=pa[l]),n=Y(l,o,r),a+=n}}return a}function Q(){var e="",a="",s=[],o={},l={},n={};s=$.extend(!0,[],oa);for(var r=0;r<userJokerInfo.length;r++){var i=userJokerInfo[r];i.id==ia[1]?1===i.isOwner?e=F(i):ia[1]=null:i.id==ia[2]&&(1===i.isOwner?a=F(i):ia[2]=null)}$("#deck_1st_box").html("").html(e),$("#deck_2nd_box").html("").html(a);for(var r=0;r<userCardInfo.length;r++)n[userCardInfo[r].id]=$.extend(!0,[],userCardInfo[r]);var t=W(s,n);l=t.shortageCardList,o=t.tempDeckList;var d=U(l,n,o);l=d.shortageCardList,o=d.tempDeckList,s=Ge(o),$("#deck_card").html("").html(X(s)),re(),He()}function Y(e,a,s){var o="",l=e%1e4,n=masterCard[l],r=ka[l]?ka[l]:l,i="",t=n.s_img,d=n.cost,c=n.op,_=n.imgClass,p="",m="display_none",v="",k="display_none",C="display_none";return e>=1e4&&(i="display_block"),p=n.sprite?'<div class="card_image '+_+'"></div> ':'<div class="card_image" style="background:url('+t+') no-repeat;background-size:100%;"></div>',s>0&&(v='<div class="invalid_card display_block" name="shortage_count" data-value="'+s+'"></div>'),Ca.indexOf(e)>=0&&(m="display_block"),za===La.CP?k="display_block":za===La.OP&&(C="display_block"),o='<li id="deck_'+e+'" data-id="'+e+'" data-reguId="'+r+'"> '+p+'<div class="foil '+i+'"></div> <div class="deck_attention_ic"><div class="regulation_alert" name="regulation_alert"></div> <div class="classic_ico '+m+'"></div></div>'+v+'<div class="card_quantity">x'+a+'</div> <div class="darken"></div> <div class="sub_parameter cp_bg '+k+'">'+d+'</div><div class="sub_parameter op_bg '+C+'">'+c+"</div></li>"}function Z(){va.isRegulation&&(te(),na?(na=!1,$("#regulation_tab").removeClass("display_block").addClass("display_none"),$("#detail_SP_tab").removeClass("off").addClass("on"),$("#detail_flavor_tab").removeClass("on").addClass("off"),$("#regulation_tab").removeClass("on").addClass("off"),$("#card_detail_SP").removeClass("display_none").addClass("display_block"),$("#card_detail_flavor").removeClass("display_block").addClass("display_none"),$("#regulation_info").removeClass("display_block").addClass("display_none"),$("#voice_info").removeClass("display_block").addClass("display_none"),$("#deck_filter_regulation_bt").removeClass("bt_filter_regulation_on").addClass("bt_filter_regulation_off"),$(".regulation_alert").removeClass("display_block").addClass("display_none"),$("#p_deck_element").removeClass("disable usable"),$("#m_deck_element").removeClass("disable usable")):(na=!0,$("#deck_filter_regulation_bt").removeClass("bt_filter_regulation_off").addClass("bt_filter_regulation_on"),ee()),aa||va.regulationDeckRankType==-1||He(),oe(),Ne())}function ee(){for(var e=0;e<oa.length;e++){var a=oa[e].id,s=ae(a);s>0&&$(".regulation_alert","#deck_"+a).removeClass("display_none").addClass("display_block")}}function ae(e){for(var a=0,s=e%1e4,o=0,l=0;l<oa.length;l++)s==oa[l].id%1e4&&(o+=oa[l].cnt);return s in va.regulationCard&&(a=o-va.regulationCard[s]),a}function se(){ia[1]=null,ia[2]=null,oa=[],Ca=[],pa={},$("#deck_1st_box").html(""),$("#deck_2nd_box").html(""),$("#deck_card").html(""),$("#cardbox_card .darken").removeClass("display_block").addClass("display_none"),$("#cardbox_joker .darken").removeClass("display_block").addClass("display_none"),te(),He(),oe(),re()}function oe(){var e=[],a=$.extend(!0,[],userCardInfo),s=[];if(ma=[],ya=0,fa=1,a=a.filter(Xe.searchFilter),a=a.filter(Xe.filterCardBox),na&&ra)for(var o=a.length-1;o>=0;o--){var l=a[o].id%1e4,n=a[o].cnt,r=0;l in va.regulationCard&&(r=va.regulationCard[l],0==r?a.splice(o,1):r>0&&n>r&&(a[o].cnt=r))}for(var o=0;o<oa.length;o++)for(var i=0;i<a.length;i++)if(oa[o].id==a[i].id){a[i].cnt-=oa[o].cnt,a[i].cnt<0&&(a[i].cnt=0);break}if(a=Xe.sortCardBox(a),0!=localStorage.cardBoxCardCount)for(var o=0;o<a.length;o++)o%ua==0&&(e=[],ya++),e.push(a[o]),e.length!=ua&&o+1!=a.length||ma.push(e);else ya=1,ma=[a];Ra==constant.edit.card&&ma.length>1?($("#left_s_bt").removeClass("disable"),$("#right_s_bt").removeClass("disable"),$("#sub_menu_page_left").removeClass("disable"),$("#sub_menu_page_right").removeClass("disable")):($("#sub_menu_page_left").addClass("disable"),$("#sub_menu_page_right").addClass("disable")),s=0!==ma.length?ma[0]:[],ie(s),$("#cardbox_page_den").html("").html(ya),$("#sub_page_den").html("").html(ya)}function le(){for(var e="",a=0;a<userJokerInfo.length;a++){var s=userJokerInfo[a];if(0!==s.isOwner){var o="img/cards/joker/thum/joker_"+s.jokerTag+".jpg",l=s.id,n="display_none",r=Pe(l),i=s.cp,t=s.op,d="display_none",c="display_none";r||(n="display_block"),za===La.CP?d="display_block":za===La.OP&&(c="display_block");var _='<li id="jokerbox_'+s.id+'" data-id="'+s.id+'"><div class="card_image" style="background: url('+o+'); background-size: 60px;"></div><div class="sub_parameter cp_bg '+d+'">'+i+'</div><div class="sub_parameter op_bg '+c+'">'+t+'</div><div class="joker_char '+s.agentTag+'"></div><div class="joker_no no'+s.no+'"></div><div class="darken '+n+'"></div> </li>';e+=_}}$("#cardbox_joker").html("").html(e)}function ne(){re(),te(),deviceInfo.isMobile&&s()}function re(){var e=60,a=5,s=10,o=oa.length,l=$("#deck_frame").width(),n=$("#deck_joker").width(),r=0,i=0;r=deviceInfo.isMobile&&1==ca?(e+a)*o>=l-n?(e+a)*o:l-n:(e+a)*Math.ceil(o/ca)>l-n?(e+a)*Math.ceil(o/ca):l-n,i=r+n+s,$("#deck_card").css("width",r),$("#deck_contents").css("width",i)}function ie(e){for(var a="",s=0;s<e.length;s++){var o="",l=e[s].id,n=l%1e4,r=ka[n]?ka[n]:n,i=masterCard[n],t=e[s].cnt,d=i.s_img,c=i.imgClass,_=i.op,p=i.cost,m="",v="",k=!1,C="",b="display_none",u="display_none";k=je(l),l>=1e4&&(C="display_block"),k||(v="display_block"),m=i.sprite?'<div class="card_image '+c+'"></div> ':'<div class="card_image" style="background:url('+d+') no-repeat;background-size:100%;"></div>',za===La.CP?b="display_block":za===La.OP&&(u="display_block"),o='<li id="cardbox_'+l+'" data-id="'+l+'" data-reguId="'+r+'">'+m+'<div class="foil '+C+'"></div><div class="card_quantity">x'+t+'</div><div class="darken '+v+'"></div><div class="sub_parameter cp_bg '+b+'">'+p+'</div><div class="sub_parameter op_bg '+u+'">'+_+"</div></li>",a+=o}$("#cardbox_page_num").html("").html(fa),$("#sub_page_num").html("").html(fa),$("#cardbox_card").html("").html(a),Aa.removeClass("display_block").addClass("display_none")}function te(){(Ra==constant.edit.card||Ra!==constant.edit.card&&null!==ga&&0!==ga)&&$("#deck_move_frame").removeClass("display_block").addClass("display_none"),$("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),deviceInfo.isMobile?$("#menu_detail").removeClass("display_block").addClass("display_none"):(ga=0,$a=0,Qe.cardDetailDialog(ga,!0,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none"))}function de(){if(Ra==constant.edit.card){var e=0;ya>1&&(te(),fa<ya?fa++:fa=1,e=fa-1,ie(ma[e]),$("#cardbox_page_num").html("").html(fa),$("#sub_page_num").html("").html(fa))}}function ce(){if(Ra==constant.edit.card){var e=0;ya>1&&(te(),fa>1?fa--:fa=ya,e=fa-1,ie(ma[e]),$("#cardbox_page_num").html("").html(fa),$("#sub_page_num").html("").html(fa))}}function _e(){var e=5,a=2,s=$(this),o=$("#cardbox_contents").scrollTop(),l=s.position().top+o-e,n=s.position().left-a,r=0,i=!0;$("#regulation_tab").removeClass("display_block").addClass("display_none"),$("#detail_SP_tab").removeClass("off").addClass("on"),$("#detail_flavor_tab").removeClass("on").addClass("off"),$("#regulation_tab").removeClass("on").addClass("off"),$("#card_detail_SP").removeClass("display_none").addClass("display_block"),$("#card_detail_flavor").removeClass("display_block").addClass("display_none"),$("#regulation_info").removeClass("display_block").addClass("display_none"),$("#voice_info").removeClass("display_block").addClass("display_none"),r=parseInt(s.attr("data-id"),10),ga=r,$a=parseInt(s.attr("data-reguId"),10),i=je(ga),deviceInfo.isMobile||(Qe.cardDetailDialog(ga,!0,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")),i?$("#cardbox_move_frame").removeClass().addClass("card_move"):$("#cardbox_move_frame").removeClass().addClass("card_notmove"),$("#deck_move_frame").removeClass("display_block").addClass("display_none"),$("#cardbox_move_frame").removeClass("display_none").addClass("display_block"),
$("#cardbox_move_frame").css({top:l,left:n}),$("#menu_detail").removeClass("display_none").addClass("display_block")}function pe(e){Ra!==constant.edit.card&&($("#deck_card").removeClass("pointer"),$("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),$("#deck_move_frame").removeClass("joker_move").addClass("card_move"),$("#p_cardbox_element").removeClass("display_none").addClass("display_block"),$("#m_cardbox_title").removeClass().addClass("cardbox_title_card"),$("#menu_detail").removeClass("display_none").addClass("display_block"),Ra=constant.edit.card,$e()),$(e.target).closest("li").length||($("#deck_move_frame").removeClass("display_block").addClass("display_none"),te()),ya>1&&($("#sub_menu_page_left").removeClass("disable"),$("#sub_menu_page_right").removeClass("disable")),$("#sub_menu_search_filter").removeClass("disable"),$("#sub_page_num").html("").html(fa),$("#sub_page_den").html("").html(ya)}function me(){var e=5,a=6,s=$(this),o=s.position().top-e,l=s.position().left-a,n="",r=0;r=parseInt(s.attr("data-id"),10),ga=r,$a=parseInt(s.attr("data-reguId"),10);var i=!0,t=parseInt($(".invalid_card","#deck_"+ga).attr("data-value"),10),d=$(".card_quantity","#deck_"+ga).html();d=parseInt(d.slice(1),10),"undefined"!=typeof t&&d<=t&&(i=!1),deviceInfo.isMobile||(Qe.cardDetailDialog(ga,i,!1),$("#card_detail_zoom").removeClass("display_block").addClass("display_none")),na&&(n=ve(ga),""!=n?($("#regulation_info").html("").html(n),$("#regulation_tab").removeClass("display_none").addClass("display_block")):($("#regulation_info").html(""),$("#regulation_tab").removeClass("display_block").addClass("display_none"))),$("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),$("#menu_detail").removeClass("display_none").addClass("display_block"),$("#deck_move_frame").css({top:o,left:l}),$("#deck_move_frame").removeClass("display_none").addClass("display_block")}function ve(e){for(var a="",s=masterCard[e%1e4],o=0;o<va.regulation.colorIds.length;o++)if(va.regulation.colorIds[o]==s.color){a+="<p>"+va.regulationExplanation.color+"</p>";break}for(var o=0;o<va.regulation.cost.length;o++)if(va.regulation.cost[o]==s.cost){a+="<p>"+va.regulationExplanation.cost+"</p>";break}for(var o=0;o<va.regulation.rarityIds.length;o++)if(va.regulation.rarityIds[o]==s.rarity){a+="<p>"+va.regulationExplanation.rarity+"</p>";break}for(var o=0;o<va.regulation.speciesIds.length;o++)if(va.regulation.speciesIds[o]==s.species){a+="<p>"+va.regulationExplanation.species+"</p>";break}for(var o=0;o<va.regulation.typeIds.length;o++)if(va.regulation.typeIds[o]==s.type){a+="<p>"+va.regulationExplanation.type+"</p>";break}for(var o=0;o<va.regulation.versionIds.length;o++)if(va.regulation.versionIds[o]==s.ver){a+="<p>"+va.regulationExplanation.version+"</p>";break}return G(e)&&(a+="<p>"+va.regulationExplanation.criteriaCardPoint+"</p>"),""===a&&""!=va.regulationExplanation.deckLimit&&va.regulationCard[e%1e4]<3&&(a+="<p>"+va.regulationExplanation.deckLimit+"</p>"),($("#p_deck_element").hasClass("disable")||$("#m_deck_element").hasClass("disable"))&&(a+="<p>"+va.regulationExplanation.criteriaDeckRank+"</p>"),a}function ke(){var e=null,a=0;e=deviceInfo.isMobile?$("#deck_area"):$("#deck_frame"),a=e.scrollLeft(),Va!==a&&(Ha||te()),Va=a}function Ce(){var e=$("#cardbox_contents").scrollTop();Ja!==e&&te(),Ja=e}function be(){$("#card_detail_text").removeClass().addClass("detail_flavor")}function ue(){var e=$(this),a=e.position().top-5,s=e.position().left-6;ga=ia[1],Ra==constant.edit.card?($("#deck_card").addClass("pointer"),Ra=constant.edit.joker1,ge()):Ra==constant.edit.joker2&&($("#deck_card").addClass("pointer"),Ra=constant.edit.joker1),null==ia[1]||0==ia[1]?($("#menu_detail").removeClass("display_block").addClass("display_none"),$("#deck_move_frame").removeClass("card_move").addClass("joker_move")):($("#menu_detail").removeClass("display_none").addClass("display_block"),$("#deck_move_frame").removeClass("joker_move").addClass("card_move")),$("#p_cardbox_element").removeClass("display_block").addClass("display_none"),$("#m_cardbox_title").removeClass().addClass("cardbox_title_joker1"),$("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),$("#deck_move_frame").removeClass("display_none").addClass("display_block"),$("#deck_move_frame").css({top:a,left:s}),$("#sub_menu_search_filter").addClass("disable"),$("#sub_menu_page_left").addClass("disable"),$("#sub_menu_page_right").addClass("disable"),$("#sub_page_num").html("").html("1"),$("#sub_page_den").html("").html("1"),deviceInfo.isMobile||Qe.jokerDetailDialog(ga);for(var o=0;o<userJokerInfo.length;o++){var l=!1,n=parseInt(userJokerInfo[o].id,10),r=$("#jokerbox_"+String(n)+" .darken");l=Pe(n),l?r.removeClass("display_block").addClass("display_none"):r.removeClass("display_none").addClass("display_block")}}function fe(){var e=$(this),a=e.position().top-5,s=e.position().left-6;ga=ia[2],Ra==constant.edit.card?($("#deck_card").addClass("pointer"),Ra=constant.edit.joker2,ge()):Ra==constant.edit.joker1&&($("#deck_card").addClass("pointer"),Ra=constant.edit.joker2),null==ia[2]||0==ia[2]?($("#menu_detail").removeClass("display_block").addClass("display_none"),$("#deck_move_frame").removeClass("card_move").addClass("joker_move")):($("#menu_detail").removeClass("display_none").addClass("display_block"),$("#deck_move_frame").removeClass("joker_move").addClass("card_move")),$("#p_cardbox_element").removeClass("display_block").addClass("display_none"),$("#m_cardbox_title").removeClass().addClass("cardbox_title_joker2"),$("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),$("#deck_move_frame").removeClass("display_none").addClass("display_block"),$("#deck_move_frame").css({top:a,left:s}),$("#sub_menu_search_filter").addClass("disable"),$("#sub_menu_page_left").addClass("disable"),$("#sub_menu_page_right").addClass("disable"),$("#sub_page_num").html("").html("1"),$("#sub_page_den").html("").html("1"),deviceInfo.isMobile||Qe.jokerDetailDialog(ga);for(var o=0;o<userJokerInfo.length;o++){var l=!1,n=parseInt(userJokerInfo[o].id,10),r=$("#jokerbox_"+String(n)+" .darken");l=Pe(n),l?r.removeClass("display_block").addClass("display_none"):r.removeClass("display_none").addClass("display_block")}}function ye(){var e=$(this),a=$("#cardbox_contents").scrollTop(),s=e.position().top+a-5,o=e.position().left-2,l=0,n=!0;l=parseInt(e.attr("data-id"),10),ga=l,n=Pe(ga),deviceInfo.isMobile||Qe.jokerDetailDialog(ga),n?$("#cardbox_move_frame").removeClass().addClass("card_move"):($("#cardbox_move_frame").removeClass().addClass("card_notmove"),$("#deck_move_frame").removeClass("card_move").addClass("joker_move")),$("#cardbox_move_frame").removeClass("display_none").addClass("display_block"),$("#menu_detail").removeClass("display_none").addClass("display_block"),$("#cardbox_move_frame").css({top:s,left:o})}function ge(){$("#cardbox_card").removeClass("display_block").addClass("display_none"),$("#cardbox_joker").removeClass("display_none").addClass("display_block")}function $e(){$("#cardbox_card").removeClass("display_none").addClass("display_block"),$("#cardbox_joker").removeClass("display_block").addClass("display_none")}function he(){Ra==constant.edit.card&&(Ee(),te(),deviceInfo.isMobile&&$("body").removeClass().addClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none"),$("#filter_wrapper").removeClass("display_none").addClass("display_block"))}function Re(e){deviceInfo.isMobile?(Xe.mobileFilterCancel(),$("body").removeClass(),$("#filter_wrapper").removeClass("display_block").addClass("display_none")):$(e.target).closest("#filter_palette").length&&!$(e.target).closest("#close_filter_bt").length||$("#filter_wrapper").removeClass("display_block").addClass("display_none")}function xe(){var e=87,a=null,o=0,l=0;1==ca?(ca=2,$("#deck_contents").removeClass("deck_1row").addClass("deck_2row"),$("#deck_row_bt").removeClass("bt_deck_1row").addClass("bt_deck_2row"),$("#deck_card").css("height",2*e)):(ca=1,$("#deck_contents").removeClass("deck_2row").addClass("deck_1row"),$("#deck_row_bt").removeClass("bt_deck_2row").addClass("bt_deck_1row"),$("#deck_card").css("height",e)),Ra==constant.edit.joker1?a=$("#deck_1st"):Ra==constant.edit.joker2&&(a=$("#deck_2nd")),Ra!==constant.edit.card&&(o=a.position().top-5,l=a.position().left-6,$("#deck_move_frame").css({top:o,left:l})),te(),re(),s()}function Ee(){deviceInfo.isMobile&&(ha==constant.menu.open?(ha=constant.menu.close,$("#sub_menu_sort_save").removeClass("on"),$("#pallete_wrapper").removeClass("display_block").addClass("display_none")):(ha=constant.menu.open,$("#sub_menu_sort_save").addClass("on"),$("#pallete_wrapper").removeClass("display_none").addClass("display_block")),te())}function Ie(){Ka=!0,Ra==constant.edit.card?Se():($("#cardbox_move_frame").removeClass("display_block").addClass("display_none"),De())}function Se(){var e=ga,a=e%1e4,s=a+1e4,o="deck_"+e,l="",n="",r="",i="",t=0,d=0,c=!1,_=!1,p=3,m=0,v=[],k=ma[fa-1],C=0,b=!1,u=0;e>=1e4&&(c=!0),l="cardbox_"+a,n="cardbox_"+s,a!=$a&&(r="cardbox_"+$a,i="cardbox_"+($a+1e4),_=!0);for(var f=0;f<ma.length;f++){for(var y=0;y<ma[f].length;y++){var g=ma[f][y].id;if(g==ga){m=f,v=ma[f];break}}if(v.length>0)break}for(var f=0;f<oa.length;f++)if(ga==parseInt(oa[f].id,10)){if(oa[f].cnt>0&&(oa[f].cnt--,d=oa[f].cnt,0==d&&(oa.splice(f,1),Ca.indexOf(e)>=0))){var h=0;h=Ca.indexOf(e),Ca.splice(h,1)}break}if(e in pa&&(b=!0,pa[e]--,u=pa[e],u>0?$(".invalid_card","#"+o).attr("data-value",u):($(".invalid_card","#"+o).addClass("display_none"),delete pa[e])),d>0?$(".card_quantity","#"+o).html("").html("x"+d):(Oe($("#"+o)),te(),re()),na&&ra&&(C=ae(e),C>0?($(".regulation_alert","#deck_"+a).removeClass("display_none").addClass("display_block"),$(".regulation_alert","#deck_"+s).removeClass("display_none").addClass("display_block")):($(".regulation_alert","#deck_"+a).removeClass("display_block").addClass("display_none"),$(".regulation_alert","#deck_"+s).removeClass("display_block").addClass("display_none"))),He(),!b){na&&ra&&a in va.regulationCard&&(p=va.regulationCard[a]);for(var f=0;f<v.length;f++)if(e==v[f].id){ma[m][f].cnt++,ma[m][f].cnt>p&&(ma[m][f].cnt=p),t=ma[m][f].cnt;break}}if(98==Ea)for(var f=0;f<k.length;f++)je(k[f].id)?$("#cardbox_"+k[f].id+" .darken").removeClass("display_block").addClass("display_none"):$("#cardbox_"+k[f].id+" .darken").removeClass("display_none").addClass("display_block");else if(je(a)&&$("#"+l+" .darken").removeClass("display_block").addClass("display_none"),je(s)&&$("#"+n+" .darken").removeClass("display_block").addClass("display_none"),a in ka){var R=ka[a],x=R+1e4;je(R)&&!na&&$("#"+r+" .darken").removeClass("display_block").addClass("display_none"),je(x)&&!na&&$("#"+i+" .darken").removeClass("display_block").addClass("display_none")}c?$(".card_quantity","#"+n).html("").html("x"+t):$(".card_quantity","#"+l).html("").html("x"+t)}function Oe(e){var a=parseInt(e.css("top").replace("px",""),10),s=parseInt(e.css("left").replace("px",""),10),o=parseInt(e.css("width").replace("px",""),10),l=parseInt(e.css("height").replace("px",""),10),n={height:"0px",width:"0px",left:s+o/2+"px",top:a+l/2+"px"};e.animate(n,50,"swing",function(){e.remove()})}function De(){var e=0,a=null;if(ga=0,Ra==constant.edit.joker1?(e=1,a=$("#deck_1st_box")):Ra==constant.edit.joker2&&(e=2,a=$("#deck_2nd_box")),null!=ia[e]&&$("#deck_move_frame").hasClass("joker_move"))$("#deck_move_frame").removeClass("joker_move").addClass("card_move");else{a.html(""),$("#deck_move_frame").removeClass("card_move").addClass("joker_move"),ia[e]=null,deviceInfo.isMobile?$("#menu_detail").removeClass("display_block").addClass("display_none"):Qe.jokerDetailDialog(),He();for(var s=0;s<userJokerInfo.length;s++){var o=parseInt(userJokerInfo[s].id,10),l=!1,n=$("#jokerbox_"+String(o)+" .darken");l=Pe(o),l&&n.removeClass("display_block").addClass("display_none")}}}function we(){if(Ra==constant.edit.card){for(var e=ga,a=e%1e4,s=a+1e4,o="",l="",n="",r="",i=!1,t="deck_"+e,d=0,c=0,_=0,p=[],m="",v=!0,k=!1,C={id:e,cnt:1},b=0;b<ma.length;b++){for(var u=0;u<ma[b].length;u++){var f=ma[b][u].id;if(f==ga){_=b,p=ma[b];break}}if(p.length>0)break}if(Ka=!0,o="cardbox_"+a,l="cardbox_"+s,e>=1e4&&(i=!0),ka[a]){var y=ka[a];n="cardbox_"+y,r="cardbox_"+(y+1e4),k=!0}if(v=je(e)){for(var b=0;b<oa.length;b++)if(e==oa[b].id){oa[b].cnt>0&&(oa[b].cnt++,c=oa[b].cnt);break}0==c?(oa.push(C),m=Y(e,1,0),$("#deck_card").append(m),re()):$(".card_quantity","#"+t).html("").html("x"+c),Te(e),He();for(var b=0;b<p.length;b++)if(e==p[b].id){ma[_][b].cnt>0&&(ma[_][b].cnt--,d=ma[_][b].cnt);break}if(Ea>=99&&$("#cardbox_card .darken").removeClass("display_none").addClass("display_block"),je(a)||$("#"+o+" .darken").removeClass("display_none").addClass("display_block"),je(s)||$("#"+l+" .darken").removeClass("display_none").addClass("display_block"),a in ka){var g=ka[a],h=g+1e4;je(g)||na||$("#"+n+" .darken").removeClass("display_none").addClass("display_block"),je(h)||na||$("#"+r+" .darken").removeClass("display_none").addClass("display_block")}je(e)||te(),i?$(".card_quantity","#"+l).html("").html("x"+d):$(".card_quantity","#"+o).html("").html("x"+d)}}else{var R=0,x={},E="",I="",v=!1,S=null,O="display_none",D="display_none";v=Pe(ga),Ra==constant.edit.joker1?(R=1,S=$("#deck_1st_box")):Ra==constant.edit.joker2&&(R=2,S=$("#deck_2nd_box")),za===La.CP?O="display_block":za===La.OP&&(D="display_block");for(var b=0;b<userJokerInfo.length;b++)if(userJokerInfo[b].id==ga){x=userJokerInfo[b];var w=x.cp,T=x.op;E="img/cards/joker/thum/joker_"+x.jokerTag+".jpg",I='<div class="card_image" style="background: url('+E+'); background-size: 60px;"></div><div class="sub_parameter cp_bg '+O+'">'+w+'</div><div class="sub_parameter op_bg '+D+'">'+T+'</div><div class="joker_char '+x.agentTag+'"></div><div class="joker_no no'+x.no+'"></div>';break}if(v){ia[R]=ga,S.html("").html(I),$("#cardbox_move_frame").removeClass("display_block").removeClass("display_none"),He();for(var b=0;b<userJokerInfo.length;b++){var A=parseInt(userJokerInfo[b].id,10),P=$("#jokerbox_"+String(A)+" .darken");P.removeClass("display_none").addClass("display_block")}}}}function Te(e){var a=$("#deck_"+e),s=null,o=0,l=a.position().left,n=0,r=60,i=0,t=!1,d=0;s=deviceInfo.isMobile?$("#deck_area"):$("#deck_frame"),o=s.width(),n=s.scrollLeft(),i=l+r-o,l-n<0?(t=!0,d=l):l+r-n>o&&(t=!0,d=i),t?(Ha=!0,s.animate({scrollLeft:d},400,function(){Ia&&Ae(a),clearTimeout(Ga),Ga=setTimeout(function(){Ha=!1},500)})):Ia&&Ae(a)}function Ae(e){var a=$("#move_effect");a.addClass("display_none").removeClass("move_anim");var s=e.position().top,o=e.position().left;a.css({top:s,left:o}),a.removeClass("display_none").css("display","block");var l=s-10,n=o-10;a.css({width:"60px",height:"85px","background-color":"#42a419",border:"none","border-radius":"1px",opacity:0}),a.animate({width:"60px",height:"85px",borderRadius:1,backgroundColor:"#42a419",opacity:.3},16,function(){a.animate({width:"60px",height:"85px",borderRadius:2,backgroundColor:"#42a419",opacity:.5},64,function(){a.animate({width:"60px",height:"85px",borderRadius:3,backgroundColor:"#42a419",opacity:.6},72,function(){a.animate({width:"60px",height:"85px",borderRadius:3,backgroundColor:"#20ff1a",opacity:.6},28,function(){a.animate({width:"80px",height:"105px",borderRadius:15,left:n,top:l,backgroundColor:"#20ff1a",opacity:0},220,function(){a.addClass("display_none")})})})})})}function Pe(e){var a=!0;if(Ra==constant.edit.joker1&&null!==ia[1])a=!1;else if(Ra==constant.edit.joker2&&null!==ia[2])a=!1;else{for(var s="",o="",l="",n=0;n<userJokerInfo.length;n++){var r=userJokerInfo[n];r.id==ia[1]?s=r.agentTag:r.id==ia[2]?o=r.agentTag:r.id==e&&(l=r.agentTag)}s!=l&&o!=l||(a=!1)}return a}function je(e){var a=!0,s=e%1e4,o=0,l=0,n=fa-1,r=ma[n],i=3,t=3,d=0,c=0;na&&ra&&(s in va.regulationCard&&(i=va.regulationCard[s]),s==ka[ka[s]]&&(i+=i));for(var _=0;_<oa.length;_++){var p=oa[_].id%1e4;s!=p&&s!=ka[p]||(o+=oa[_].cnt),s!=p&&s+1e4!=oa[_].id||(d+=oa[_].cnt),p==ka[ka[p]]&&(s!=p&&s+1e4!=oa[_].id||(c+=oa[_].cnt))}if(Ea>=99)a=!1;else if(d>=t||c>=t)a=!1;else if(o>=i)a=!1;else for(var _=0;_<r.length;_++)if(e==r[_].id){l=ma[n][_].cnt,0==l&&(a=!1);break}return a}function Ne(){var e=!0,a=Fa.OK;if(na){for(var s=0,o=0;o<oa.length;o++){var l=oa[o].id,n=oa[o].cnt,r=0,i=ae(l);i>0&&(e=!1,a=Fa.EVENT_ERROR),va.regulationDeckRankType!=-1&&(r=masterCard[l%1e4].op*n,s+=r)}for(var o=0;o<userJokerInfo.length;o++){var t=userJokerInfo[o];t.id!=ia[1]&&t.id!=ia[2]||(s+=t.op)}if(va.regulationDeckRankType!=-1){for(var d=!0,c=0,o=0;o<constant.deckRank.length;o++){var _=constant.deckRank[o].p;if(!(s>=_))break;c=constant.deckRank[o].id}0==va.regulationDeckRankType&&c<va.regulationDeckRank?d=!1:1==va.regulationDeckRankType&&c<=va.regulationDeckRank?d=!1:2==va.regulationDeckRankType&&c>=va.regulationDeckRank?d=!1:3==va.regulationDeckRankType&&c>va.regulationDeckRank?d=!1:4==va.regulationDeckRankType&&c==va.regulationDeckRank?d=!1:5==va.regulationDeckRankType&&c!=va.regulationDeckRank&&(d=!1),d?(e=!1,a=Fa.EVENT_ERROR,$("#p_deck_element").removeClass("usable").addClass("disable"),$("#m_deck_element").removeClass("usable").addClass("disable")):($("#p_deck_element").removeClass("disable").addClass("usable"),$("#m_deck_element").removeClass("disable").addClass("usable"))}}else for(o=0;o<oa.length;o++){var p=0,m=3;l=oa[o].id,n=oa[o].cnt;for(var v=0;v<oa.length;v++)l%1e4==oa[v].id%1e4?p+=oa[v].cnt:l%1e4==ka[oa[v].id%1e4]&&(p+=oa[v].cnt);p>m&&(e=!1,a=Fa.SAME_CARD_OVER_ERROR)}return null!=ia[1]&&null!=ia[2]||(e=!1,a=Fa.JOKER_ERROR),0!==Object.keys(pa).length&&(e=!1,a=Fa.SHORTAGE_ERROR),Ea!=Ze&&(e=!1,a=Fa.CARD_COUNT_ERROR),e?$("#deck_save_bt").removeClass("bt_no_save").addClass("save_enable"):$("#deck_save_bt").removeClass("save_enable").addClass("bt_no_save"),a}function Le(){Da==Sa.DECK_SAVE_WARNING?Ve():Ye.clickDialogAcceptBtn()}function ze(){if(Oa==Sa.DECK_RECIPE_PREVIEW&&($("#deck_recipe_wrapper").removeClass("display_none").addClass("display_block"),$("#deck_recipe_preview").removeClass("display_none").addClass("display_block")),Da==Sa.DECK_SAVE_WARNING){Oa=Da,Da=Sa.CLOSE;for(var e=0;e<oa.length;e++){var a=oa[e].id%1e4;denyVersion.indexOf(masterCard[a].ver)>=0&&Ca.indexOf(oa[e].id)<0&&(Ca.push(oa[e].id),$("#deck_"+oa[e].id+" .classic_ico").removeClass("display_none").addClass("display_block"))}deviceInfo.isMobile&&$("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none")}else Ye.clickDialogDeclineBtn()}function Be(){Da===Sa.DECK_SAVE_SUCCESS?ja?location.href="/deck_list":qe():Oa===Sa.DECK_RECIPE_PREVIEW?(qe(),Ue()):ja?location.href="/deck_list":qe()}function Me(){var e=!1;Q(),na&&ee();var a=Ne(),s="";if(ha==constant.menu.open&&Ee(),a===Fa.OK){for(var o=0;o<oa.length;o++){var l=oa[o].id%1e4;if(denyVersion.indexOf(masterCard[l].ver)>=0&&!na){e=!0;break}}e?(Oa=Da,Da=Sa.DECK_SAVE_WARNING,s=wa.NATIONAL_SAVE_ERROR,(new CommonDialogClass).DisplayDialog(s,{yes:!0,no:!0})):Ve()}else s="",a===Fa.CARD_COUNT_ERROR?s=wa.CARD_COUNT_SAVE_ERROR:a===Fa.JOKER_ERROR?s=wa.JOKER_SAVE_ERROR:a===Fa.EVENT_ERROR?s=wa.EVENT_SAVE_ERROR:a===Fa.SHORTAGE_ERROR?s=wa.SHORTAGE_SAVE_ERROR:a===Fa.SAME_CARD_OVER_ERROR&&(s=wa.SAME_CARD_OVER_ERROR),Oa=Da,Da=Sa.DECK_SAVE_WARNING,(new CommonDialogClass).DisplayDialog(s,{close:!0})}function Ve(){var e="",a={uk:uk,deckId:la,joker:{1:ia[1],2:ia[2]},card:oa,isDicision:0,isSave:1,updateDate:0};$.ajax({url:"/save_deck",contentType:"application/json",dataType:"json",data:JSON.stringify(a),type:"POST",timeout:2e4,success:function(a,s,o){if(a.status!=constant.responseStatus.SUCCESS)return void Qe.error(a.status);Ka=!1,e='<p class="tx_c">デッキ保存に成功しました。</p>';for(var l=0;l<_a.length;l++)if(la==_a[l].deckId){_a[l].card=oa,_a[l].jokerAbility[1]=ia[1],_a[l].jokerAbility[2]=ia[2];break}Oa=Da,Da=Sa.DECK_SAVE_SUCCESS,(new CommonDialogClass).DisplayDialog(e,{close:!0})},error:function(){Qe.error(constant.responseStatus.EXCEPTION_ERROR)}})}function Je(){var e={j:{1:0,2:0},c:[]};e.j[1]=ia[1],e.j[2]=ia[2],e.c=oa,sessionStorage.cd=JSON.stringify(e),$("#deck_paste_bt").removeClass("disable")}function Ke(){if(sessionStorage.cd){var e=JSON.parse(sessionStorage.cd);te(),ia[1]=e.j[1],ia[2]=e.j[2],oa=e.c,Q(),oe(),le(),na&&ee(),Ka=!0}}function He(){var e=0,a=0,s=0,o=0,l="",n=!1;if((aa||na&&va.regulationDeckRankType!=-1)&&(n=!0),n)for(var r=0;r<userJokerInfo.length;r++){var i=userJokerInfo[r];i.id!=ia[1]&&i.id!=ia[2]||(o+=i.op)}Ea=0;for(var r=0;r<oa.length;r++){var t=oa[r].id%1e4,d=masterCard[t].type,c=masterCard[t].op,_=oa[r].cnt;Ea+=_,n&&(o+=c*_),"unit"==constant.type[d].tag||"evolution"==constant.type[d].tag?e+=_:"trigger"==constant.type[d].tag?a+=_:"intercept"==constant.type[d].tag&&(s+=_)}if(n)for(var r=0;r<constant.deckRank.length;r++){var p=constant.deckRank[r].p;if(!(o>=p))break;l="rank_"+constant.deckRank[r].tag}Ne(),Ea>Ze?($("#p_deck_num").addClass("font_r"),$("#m_deck_num").addClass("font_r")):($("#p_deck_num").removeClass("font_r"),$("#m_deck_num").removeClass("font_r")),deviceInfo.isMobile?($("#m_deck_num").html("").html(Ea),$("#m_deck_unit").html("").html(e),$("#m_deck_trigger").html("").html(a),$("#m_deck_intercept").html("").html(s),n?($("#m_rank_img").removeClass().addClass(l),$("#m_rank_point").html("").html(o)):($("#m_rank_img").removeClass(),$("#m_rank_point").html("--"))):($("#p_deck_num").html("").html(Ea),$("#p_deck_unit").html("").html(e),$("#p_deck_trigger").html("").html(a),$("#p_deck_intercept").html("").html(s),n?($("#p_rank_img").removeClass().addClass(l),$("#p_rank_point").html("").html(o)):($("#p_rank_img").removeClass(),$("#p_rank_point").html("--")))}function Ge(e){var a=q(e);return a.sort(function(e,a){var s=e.id,o=a.id,l=e.id%1e4,n=a.id%1e4,r=masterCard[l].no,i=masterCard[n].no,t=masterCard[l].color,d=masterCard[n].color,c=masterCard[l].ver,_=masterCard[n].ver,p=masterCard[l].type,m=masterCard[n].type;return"unit"!=constant.type[masterCard[l].type].tag&&"evolution"!=constant.type[masterCard[l].type].tag||(p=1),"unit"!=constant.type[masterCard[n].type].tag&&"evolution"!=constant.type[masterCard[n].type].tag||(m=1),p<m?-1:p>m?1:t<d?-1:t>d?1:c<_?-1:c>_?1:r<i?-1:r>i?1:s<o?-1:s>o?1:0}),a}function Fe(){searchWord=$("#p_card_search").val(),te(),oe()}function We(){for(var e=parseInt($(this).attr("data-id"),10),a=!1,s={},o=0,l=Na.cardSetList.length;o<l;o++)if(Na.cardSetList[o].deckId===e){s=Na.cardSetList[o],a=!0;break}if(!a)for(var o=0,l=Na.presentList.length;o<l;o++)if(Na.presentList[o].deckId===e){s=Na.presentList[o],a=!0;break}a?(ta=oa,da[1]=ia[1],da[2]=ia[2],oa=s.cards,ia[1]=s.jokerAbility[1],ia[2]=s.jokerAbility[2],Q(),oe(),le(),$("#bt_deck_recipe_registration").hasClass("bt_no_registration")&&$("#bt_deck_recipe_registration").removeClass("bt_no_registration"),L("recipe_deck")):location.href="/error",$("#recipe_list_p1").hasClass("display_block")?(Pa=1,$("#recipe_list_p1").removeClass("display_block").addClass("display_none")):(Pa=2,$("#recipe_list_p2").removeClass("display_block").addClass("display_none")),$("#deck_recipe_name").text("").text(s.deckName),$("#deck_recipe_additional_condition").text("").text(s.additionalCondition),$("#deck_recipe_explanation").text("").text(s.explanation),Ue()}function Ue(){deviceInfo.isMobile&&($("body").hasClass("popup")||$("body").addClass("popup")),Oa=Da,Da=Sa.DECK_RECIPE_PREVIEW,$("#deck_recipe_wrapper").removeClass("display_none").addClass("display_block"),$("#deck_recipe_list").removeClass("display_block").addClass("display_none"),$("#deck_recipe_preview").removeClass("display_none").addClass("display_block")}function qe(){deviceInfo.isMobile&&$("body").removeClass("popup"),$("#common_popup_wrapper").removeClass("display_block").addClass("display_none"),Qe.resetDialogInfo(),$("#popup_container").html(""),Oa=Da,Da=Sa.CLOSE}var Xe=new cardBoxToolsClass,Qe=new commonClass,Ye=new BulletinBoardClass,Ze=40,ea=42,aa=!1,sa=0,oa=[],la=null,na=!1,ra=!0,ia={1:0,2:0},ta=[],da={1:0,2:0},ca=1,_a={},pa={},ma=[],va={contents:"",isRegulation:!1,regulationExplanation:{},regulation:{},regulationDeckRank:0,regulationDeckRankType:0,regulationCardPoint:0,regulationCardPointType:0,regulationCard:{}},ka={},Ca=[],ba=constant.menu.open,ua=100,fa=1,ya=0,ga=0,$a=0,ha=constant.menu.close,Ra=constant.edit.card,xa=[],Ea=0,Ia=!0,Sa={CLOSE:"CLOSE",DECK_SAVE_SUCCESS:"DECK_SAVE_SUCCESS",DECK_SAVE_WARNING:"DECK_SAVE_WARNING",VERSION_ERROR:"VERSION_ERROR",SESSION_ERROR:"SESSION_ERROR",EXCEPTION_ERROR:"EXCEPTION_ERROR",GAME_ROGIN_ERROR:"GAME_ROGIN_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",MP_SHORTAGE:"MP_SHORTAGE",ROGIN_MESSAGE:"ROGIN_MESSAGE",DECK_RECIPE_PREVIEW:"DECK_RECIPE_PREVIEW",DECK_RECIPE_LIST:"DECK_RECIPE_LIST",BULLETIN_BOARD:"BULLETIN_BOARD",FAVORITE:"FAVORITE"},Oa=Sa.CLOSE,Da=Sa.CLOSE,wa={CARD_COUNT_SAVE_ERROR:"デッキ内のカード枚数が40枚になっていないため保存できません。",JOKER_SAVE_ERROR:"ジョーカーが設定されていません。",EVENT_SAVE_ERROR:'<p class="tx_l">イベントレギュレーションに違反しています。</p><p class="tx_l">イベント情報からレギュレーションを確認しデッキを編集するか、イベントフィルタをOFFにしてください。</p>',NATIONAL_SAVE_ERROR:'<p class="tx_l">このデッキには全国対戦で使用できないカードが含まれています。</p><p class="tx_l">このままデッキを保存しますか？</p>',SHORTAGE_SAVE_ERROR:"デッキに未所持カードが含まれているため保存できません。",SAME_CARD_OVER_ERROR:"同一カードが4枚以上含まれています。"},Ta=$("#sub_param_toggle_bt"),Aa=$("#loading_wrapper"),Pa=0,ja=!1,Na={};Aa.removeClass("display_none").addClass("display_block"),localStorage.animationDeckEditType||(localStorage.animationDeckEditType=constant.activeState.ACTIVE),localStorage.foilCardDispType||(localStorage.foilCardDispType=constant.foilCardDispType.PARALLEL),localStorage.cardBoxCardCount||(localStorage.cardBoxCardCount=1),localStorage.cardBoxDispNational||(localStorage.cardBoxDispNational=0),parseInt(localStorage.animationDeckEditType,10)!==constant.activeState.ACTIVE&&(Ia=!1),foilCardDispType=parseInt(localStorage.foilCardDispType,10),0!=localStorage.cardBoxCardCount&&(ua=constant.cardBoxCardCount[parseInt(localStorage.cardBoxCardCount,10)]),"cd"in sessionStorage&&$("#deck_paste_bt").removeClass("disable"),e(),a(),s(),Ye.getOrderBoardInfo();var La={NONE:"NONE",CP:"CP",OP:"OP"},za=La.CP,Ba=1;constant.analyzePage={1:{name:"デッキカード一覧",tag:"img"},2:{name:"コスト分布",tag:"cp"},3:{name:"Lv1 BP分布",tag:"bp1"},4:{name:"種族分布",tag:"species"}};var Ma={cp:{caption:"",graph:[]},bp1:{caption:"",graph:[]},species:{caption:"",graph:[]}};constant.graphStackSize={small:{maxNum:null,width:4,height:4},medium:{maxNum:20,width:9,height:12},large:{maxNum:10,width:20,height:28}},"cardSubParamType"in localStorage&&(za=localStorage.cardSubParamType),$(window).on("resize",ne);var Va=0,Ja=0,Ka=!1;$(window).on("beforeunload",function(){if(Ka)return"表示されているデッキが保存されていません。このまま移動しますか？"}),$(window).on("pagehide",function(){if(Ka)return"表示されているデッキが保存されていません。このまま移動しますか？"});var Ha=!1,Ga=0,Fa={OK:"OK",CARD_COUNT_ERROR:"CARD_COUNT_ERROR",JOKER_ERROR:"JOKER_ERROR",EVENT_ERROR:"EVENT_ERROR",NATIONAL_ERROR:"NATIONAL_ERROR",SHORTAGE_ERROR:"SHORTAGE_ERROR",SAME_CARD_OVER_ERROR:"SAME_CARD_OVER_ERROR"}});