"use strict";var cardBoxToolsClass=function(){},searchWord="",denyVersion=[1,2,3,4,5],sortType=0,foilCardDispType=constant.foilCardDispType.PARALLEL,filter={favorite:!1,dop:[],ver:[],type:[],color:[],species:[],cp:[],foil:!0,normal:!0,rarity:[],count:[]};cardBoxToolsClass.prototype.focusSearchBox=function(){var e=null;e=deviceInfo.isMobile?$("#m_card_search_text"):$("#p_card_search"),e.addClass("font_w"),""===searchWord&&e.val("")},cardBoxToolsClass.prototype.displayPcFilter=function(){var e=$("#select_filter_bt"),r=$("#filter_palette"),t=e.offset().left,o=r.width(),c=e.width(),i=t-o+c;r.css("left",i),$("#filter_wrapper").removeClass("display_none").addClass("display_block")},cardBoxToolsClass.prototype.mobileFilterCancel=function(){0===searchWord.replace(/\s+/g,"").length?(searchWord="",$("#m_card_search_text").removeClass("font_w"),$("#m_card_search_text").val(constant.defaultSearchWord)):$("#m_card_search_text").val(searchWord),$("#m_card_sort_type").val(sortType),$('#filter_list input[type="checkbox"]').prop("checked",!1),filter.favorite&&$("#fav_all").prop("checked",!0);for(var e=!0,r=0;r<filter.dop.length;r++){var t=filter.dop[r];$("#dop_"+t).prop("checked",!0)}$(".filter_dop").each(function(){var r=$(this).prop("checked");r||(e=!1)}),e&&$("#dop_all").prop("checked",!0);for(var o=!0,r=0;r<filter.type.length;r++){var c=filter.type[r];$("#type_"+c).prop("checked",!0)}$(".filter_type").each(function(){var e=$(this).prop("checked");e||(o=!1)}),o&&$("#type_all").prop("checked",!0);for(var i=!0,r=0;r<filter.color.length;r++){var a=filter.color[r];$("#color_"+a).prop("checked",!0)}$(".filter_color").each(function(){var e=$(this).prop("checked");e||(i=!1)}),i&&$("#color_all").prop("checked",!0);for(var l=!0,r=0;r<filter.species.length;r++){var s=filter.species[r];$("#species_"+s).prop("checked",!0)}$(".filter_species").each(function(){var e=$(this).prop("checked");e||(l=!1)}),l&&$("#species_all").prop("checked",!0);for(var p=!0,n=!0,r=0;r<filter.ver.length;r++){for(var f=filter.ver[r],d=!1,h=0;h<denyVersion.length;h++){var u=denyVersion[h];if(f==u){d=!0;break}}d?$("#national_"+f).prop("checked",!0):$("#ver_"+f).prop("checked",!0)}$(".filter_ver").each(function(){var e=$(this).prop("checked");e||(p=!1)}),$(".filter_national").each(function(){var e=$(this).prop("checked");e||(n=!1)}),p&&$("#ver_all").prop("checked",!0),n&&$("#national_all").prop("checked",!0);for(var y=filter.cp.length,r=0;r<y;r++){var v=filter.cp[r];$("#cost_"+v).prop("checked",!0)}10==y&&$("#cost_all").prop("checked",!0),filter.normal&&$("#foil_1").prop("checked",!0),filter.foil&&$("#foil_2").prop("checked",!0),filter.normal&&filter.foil&&$("#foil_all").prop("checked",!0),$("#rarity_all").prop("checked",!0),$("#rarity_1").prop("checked",!0),$("#rarity_2").prop("checked",!0),$("#rarity_3").prop("checked",!0),$("#rarity_4").prop("checked",!0),$("#rarity_5").prop("checked",!0),$("#rarity_9").prop("checked",!0),$("#rarity_10").prop("checked",!0);for(var _=filter.count.length,r=0;r<_;r++){var C=filter.count[r];$("#count_"+C).prop("checked",!0)}6==_&&$("#count_all").prop("checked",!0)},cardBoxToolsClass.prototype.changeFilterCheckBox=function(e){var r=e.prop("checked"),t=e.attr("data-type"),o="";if("normal"===t&&(t="foil"),o="filter_"+t,e.hasClass("check_all"))r?$("."+o).prop("checked",!0):$("."+o).prop("checked",!1);else if(r){var c=0;$("."+o).each(function(){$(this).prop("checked")||c++}),0===c&&$("#"+t+"_all").prop("checked",!0)}else $("#"+t+"_all").prop("checked",!1);$("#national_all").prop("checked")||$("#national_1").prop("checked")||$("#national_2").prop("checked")||$("#national_3").prop("checked")||$("#national_4").prop("checked")||$("#national_5").prop("checked")?localStorage.cardBoxDispNational=1:localStorage.cardBoxDispNational=0,deviceInfo.isMobile||this.applyCardBoxFilter()},cardBoxToolsClass.prototype.blurSearchBox=function(){var e=null,r="";deviceInfo.isMobile?e=$("#m_card_search_text"):(e=$("#p_card_search"),searchWord=e.val()),r=e.val(),0===r.replace(/\s+/g,"").length&&(r="",e.removeClass("font_w"),e.val(constant.defaultSearchWord))},cardBoxToolsClass.prototype.filterCardBox=function(e){var r=parseInt(e.id,10),t=r%1e4,o=masterCard[t],c=o.op,i=o.type,a=o.color,l=o.species,s=o.species2,p=o.ver,n=o.rarity,f=0,d=!1,h=0;return $(".filter_species").each(function(){if(!$(this).prop("checked"))return void(d=!0)}),f=o.cost>=8?8:o.cost,(!d||"trigger"!==constant.type[i].tag&&"intercept"!==constant.type[i].tag)&&(null!==e.cnt&&(h=e.cnt>=4?4:parseInt(e.cnt,10)),!(!filter.foil&&r>1e4||!filter.normal&&r<=1e4||filter.dop.indexOf(c)<0||filter.type.indexOf(i)<0||filter.color.indexOf(a)<0||filter.species.indexOf(l)<0&&filter.species.indexOf(s)<0||filter.ver.indexOf(p)<0||filter.rarity.indexOf(n)<0||filter.cp.indexOf(f)<0||filter.favorite&&userFavCards.indexOf(r)<0||filter.count.indexOf(h)<0))},cardBoxToolsClass.prototype.sortCardBox=function(e){sortType=deviceInfo.isMobile?Number($("#m_card_sort_type").val()):Number($("#p_card_sort_type").val());var r=!1;return sortType!==constant.sort.rarityDesc.id&&sortType!==constant.sort.cpDesc.id&&sortType!==constant.sort.bpDesc.id&&sortType!==constant.sort.opDesc.id||(r=!0),e.sort(function(e,t){var o=e.id,c=t.id,i=!1,a=!1,l=e.id%1e4,s=t.id%1e4,p=masterCard[l],n=masterCard[s],f=p.type,d=n.type,h=p.ver,u=n.ver,y=p.no,v=n.no,_=p.color,$=n.color,C=p.species,g=n.species,k=p.rarity,x=n.rarity,m=p.cost,T=n.cost,b=p.bp1,B=n.bp1,S=p.op,O=n.op;if("unit"!==constant.type[p.type].tag&&"evolution"!==constant.type[p.type].tag||(f=1),"unit"!==constant.type[n.type].tag&&"evolution"!==constant.type[n.type].tag||(d=1),foilCardDispType==constant.foilCardDispType.SERIES){if(o>=1e4&&(i=!0),c>=1e4&&(a=!0),!i&&a)return-1;if(i&&!a)return 1}if(sortType===constant.sort.species.id){if(f<d)return-1;if(f>d)return 1;if(C<g)return-1;if(C>g)return 1}else if(sortType===constant.sort.rarityAsc.id||sortType===constant.sort.rarityDesc.id)if(r){if(k<x)return 1;if(k>x)return-1}else{if(k<x)return-1;if(k>x)return 1}else if(sortType===constant.sort.cpAsc.id||sortType===constant.sort.cpDesc.id)if(r){if(m<T)return 1;if(m>T)return-1}else{if(m<T)return-1;if(m>T)return 1}else if(sortType===constant.sort.bpAsc.id||sortType===constant.sort.bpDesc.id){if(f<d)return-1;if(f>d)return 1;if(r){if(b<B)return 1;if(b>B)return-1}else{if(b<B)return-1;if(b>B)return 1}}else if(sortType===constant.sort.opAsc.id||sortType===constant.sort.opDesc.id)if(r){if(S<O)return 1;if(S>O)return-1}else{if(S<O)return-1;if(S>O)return 1}if(sortType!==constant.sort.num.id){if(f<d)return-1;if(f>d)return 1;if(_<$)return-1;if(_>$)return 1}return h<u?-1:h>u?1:y<v?-1:y>v?1:o<c?-1:o>c?1:0}),e},cardBoxToolsClass.prototype.applyCardBoxFilter=function(){filter.dop=[],filter.ver=[],filter.color=[],filter.type=[],filter.species=[],filter.cp=[],filter.rarity=[],filter.count=[],$('#filter_list input[type="checkbox"]').each(function(){var e=$(this),r="",t=e.prop("checked"),o=Number(e.val());r=e.attr("data-type"),"fav"===r?t?filter.favorite=!0:filter.favorite=!1:"dop"===r?t&&filter.dop.push(o):"ver"===r||"national"===r?t&&filter.ver.push(o):"type"===r?t&&filter.type.push(o):"color"===r?t&&filter.color.push(o):"species"===r?t&&filter.species.push(o):"cost"===r?t&&filter.cp.push(o):"normal"===r?t?filter.normal=!0:filter.normal=!1:"foil"===r?t?filter.foil=!0:filter.foil=!1:"rarity"===r?t&&filter.rarity.push(o):"count"===r&&t&&filter.count.push(o)}),filter.rarity.indexOf(9)>-1&&filter.ver.push(27),filter.rarity.indexOf(10)>-1&&filter.ver.push(28),"/deck_editor"===location.pathname&&$("#filter_count").css("display","none")},cardBoxToolsClass.prototype.searchFilter=function(e){var r=searchWord.replace(/\s+/g," ").split(" "),t=/lv(\.)?2/i.test(searchWord),o=/lv(\.)?3/i.test(searchWord),c=!1,i=masterCard[e.id%1e4],a="",l="",s="",p="",n="",f="",d="",h=!1,u="",y=!1,v="",_=!1;if(!i)return!1;for(var $=0;$<r.length;$++){var C=r[$],g=/(^|\s)[0-9]{1,5}BP|BP[0-9]{1,5}(\s|$)|(^|\s)[０-９]{1,5}BP|BP[０-９]{1,5}(\s|$)/gi.test(C),k=/(^|\s)[0-9]CP|CP[0-9](\s|$)|(^|\s)[０-９]CP|CP[０-９](\s|$)/gi.test(C),x=/(オリジナル|ｵﾘｼﾞﾅﾙ)[0-9]|[0-9]P(\s|$)|(オリジナル|ｵﾘｼﾞﾅﾙ)[０-９]|[０-９]P(\s|$)/gi.test(C);if(g){var m=0;C=C.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),m=Number(C.replace(/BP|\s/gi,"")),c=!!(t&&m===i.bp2||o&&m===i.bp3||!t&&!o&&m===i.bp1)}else if(k){var T=0;C=C.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),T=Number(C.replace(/CP|\s/gi,"")),c=T==i.cost}else if(x){var b=0;C=C.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),b=Number(C.replace(/オリジナル|ｵﾘｼﾞﾅﾙ|P|\s/gi,"")),c=b===i.op}else if("複数の種族"===C||"複数種族"===C||"2種族"===C)c=null!=i.species&&i.species>0&&null!=i.species2&&i.species2>0;else{if(/lv(\.)?/i.test(C))continue;constant.color[i.color]&&(l=constant.color[i.color].text),constant.type[i.type]&&(s=constant.type[i.type].text),constant.species[i.species]&&(p=constant.species[i.species].text),constant.species[i.species2]&&(n=constant.species[i.species2].text),C=C.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),C=C.toUpperCase(),a=i.name.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),a=a.toUpperCase(),f=i.ability.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),f=f.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,""),f=f.toUpperCase(),d=i.flavor.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),d=d.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,""),d=d.toUpperCase(),e.id>1e4&&null==e.cnt?u="":e.id>1e4?(u=i.voiceFoil.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),u=u.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,""),u=u.toUpperCase()):(u=i.voiceNormal.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),u=u.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,""),u=u.toUpperCase()),v=i.ill.replace(/[Ａ-Ｚａ-ｚ０-９－！”＃＄％＆’（）＝＜＞，．？＿［］｛｝＠＾～￥]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),v=v.toUpperCase(),h=!(!localStorage.searchFlavorFlag||0==localStorage.searchFlavorFlag),y=!(!localStorage.searchVoiceFlag||0==localStorage.searchVoiceFlag),_=!(!localStorage.searchIllFlag||0==localStorage.searchIllFlag),c=!!(a.indexOf(C)>-1||a.replace(/・/g,"").indexOf(C)>-1||0===s.indexOf(C)||0===l.indexOf(C)||0===p.indexOf(C)||0===n.indexOf(C)||f.indexOf(C)>-1||f.replace(/・/g,"").indexOf(C)>-1||h&&d.indexOf(C)>-1||y&&u.indexOf(C)>-1||_&&v.indexOf(C)>-1)}if(!c)break}return c};